<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BharatBazaar OSS - Empowering Local Indian Sellers</title>
    <meta name="description" content="Hyperlocal commerce platform powered by ONDC Protocol">
    <meta name="theme-color" content="#FF9933">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366F1;
            --secondary: #10B981;
            --accent: #F59E0B;
            --background: #F9FAFB;
            --white: #FFFFFF;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 12px;
            --radius-sm: 8px;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-in {
            animation: slideInUp 0.6s ease forwards;
        }

        /* PWA Install Banner */
        .pwa-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1rem 2rem;
            display: none;
            align-items: center;
            justify-content: space-between;
            z-index: 2000;
            animation: slideInUp 0.5s ease;
        }

        .pwa-banner.active {
            display: flex;
        }

        .pwa-banner .pwa-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .pwa-banner .pwa-icon {
            font-size: 2rem;
        }

        .pwa-banner .pwa-actions {
            display: flex;
            gap: 1rem;
        }

        .btn-pwa {
            background: var(--white);
            color: var(--primary);
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-pwa:hover {
            transform: scale(1.05);
        }

        /* Sponsor Badges */
        .sponsor-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sponsor-section {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Notification Bell */
        .notification-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .notification-icon:hover {
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: var(--white);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .notification-panel {
            position: fixed;
            right: -400px;
            top: 0;
            bottom: 0;
            width: 400px;
            background: var(--white);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 2500;
            transition: var(--transition);
            overflow-y: auto;
        }

        .notification-panel.active {
            right: 0;
        }

        .notification-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E0E0E0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
        }

        .notification-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #E0E0E0;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            gap: 1rem;
            align-items: start;
        }

        .notification-item:hover {
            background: var(--background);
        }

        .notification-item.unread {
            background: rgba(255, 153, 51, 0.05);
        }

        .notification-icon-type {
            font-size: 1.5rem;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background);
            border-radius: 50%;
        }

        /* Navbar */
        .navbar {
            background: var(--white);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 2rem;
        }

        .navbar-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        /* Enhanced Logo */
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex: 1;
            justify-content: center;
        }

        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .lang-toggle {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .lang-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .cart-icon:hover {
            transform: scale(1.1);
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, #8B5CF6 100%);
            color: var(--white);
            padding: 3rem 2rem;
            text-align: center;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.95;
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Discover Section */
        .filters {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-input {
            padding: 0.75rem;
            border: 2px solid #E0E0E0;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-with-icon {
            position: relative;
        }

        .voice-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .voice-btn:hover {
            transform: translateY(-50%) scale(1.2);
        }

        .voice-btn.listening {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        #map {
            height: 500px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .sellers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: var(--shadow-sm);
        }

        .product-badge.trending {
            background: #dc3545;
        }

        .product-badge.new {
            background: var(--secondary);
        }

        .product-card {
            position: relative;
        }

        .seller-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
        }

        .seller-card {
            position: relative;
            overflow: hidden;
        }

        .seller-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .seller-card:hover::before {
            opacity: 0.1;
        }

        .seller-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .seller-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .seller-type {
            font-size: 2rem;
        }

        .verified-badge {
            background: var(--secondary);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .seller-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .seller-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .rating {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--primary);
            font-weight: 600;
        }

        /* Products Section */
        .products-header {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-icon {
            font-size: 3rem;
            text-align: center;
        }

        .product-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .product-seller {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .product-price {
            font-size: 1.3rem;
            color: var(--secondary);
            font-weight: bold;
        }

        .btn-add-cart {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-add-cart:hover {
            background: var(--secondary);
            transform: scale(1.05);
        }

        /* Impact Section */
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .impact-card {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: var(--transition);
        }

        .impact-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .impact-card.orange {
            border-top: 4px solid var(--primary);
        }

        .impact-card.green {
            border-top: 4px solid var(--secondary);
        }

        .impact-card.blue {
            border-top: 4px solid var(--accent);
        }

        .impact-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .impact-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .impact-label {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--radius);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E0E0E0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--text-dark);
            transform: scale(1.2);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #E0E0E0;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-error {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: #dc3545;
        }

        .form-group.error .form-error {
            display: block;
        }

        .shop-types-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .shop-type-card {
            padding: 1rem;
            border: 2px solid #E0E0E0;
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .shop-type-card:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .shop-type-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.1), rgba(19, 136, 8, 0.1));
        }

        .shop-type-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            position: relative;
        }

        .progress-step::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #E0E0E0;
            z-index: -1;
        }

        .progress-step:first-child::before {
            left: 50%;
        }

        .progress-step:last-child::before {
            right: 50%;
        }

        .progress-step.active .step-number {
            background: var(--primary);
            color: var(--white);
        }

        .progress-step.completed .step-number {
            background: var(--secondary);
            color: var(--white);
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #E0E0E0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .step-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-secondary {
            background: var(--white);
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Cart */
        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--background);
            border-radius: var(--radius-sm);
        }

        .cart-item-icon {
            font-size: 2rem;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--text-light);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qty-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .qty-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .cart-total {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #E0E0E0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .empty-cart {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left: 4px solid var(--secondary);
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        .toast.info {
            border-left: 4px solid var(--accent);
        }

        /* Enhanced Filters */
        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .filter-chip {
            background: var(--white);
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
        }

        /* Review Stars */
        .star-rating {
            display: inline-flex;
            gap: 0.25rem;
            color: #FFD700;
        }

        /* Featured Badge */
        .featured-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            animation: pulse 2s infinite;
        }

        /* Skeleton Loader */
        .skeleton {
            background: linear-gradient(
                90deg,
                #f0f0f0 0%,
                #e0e0e0 50%,
                #f0f0f0 100%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        /* Success Modal */
        .success-content {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--secondary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1.5rem;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: #E0E0E0;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1.5rem auto;
            font-size: 3rem;
        }

        /* Responsive */
        /* Better Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .nav-links {
                display: none !important;
            }

            .checkout, .orderTracking {
                grid-template-columns: 1fr !important;
            }

            #checkout > div > div, #orderTracking > div > div {
                grid-template-columns: 1fr !important;
            }

            .pwa-banner {
                flex-direction: column;
                text-align: center;
            }

            .notification-panel {
                width: 100%;
                right: -100%;
            }

            .notification-panel.active {
                right: 0;
            }

            .shop-types-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .navbar-container {
                flex-wrap: wrap;
            }

            .sellers-grid,
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            #storeProductGrid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
            }
            
            .modal-content {
                max-width: 95% !important;
            }
        }

        /* Location Info */
        .location-info {
            background: rgba(19, 136, 8, 0.1);
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin-top: 1rem;
            display: none;
        }

        .location-info.active {
            display: block;
        }

        .btn-location {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
        }

        .btn-location:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo" id="appName">BharatBazaar OSS</div>
            <div class="nav-links" style="display: flex;">
                <div class="nav-link active" onclick="showSection('discover')" id="navDiscover" style="cursor: pointer;">Discover</div>
                <div class="nav-link" onclick="showSection('products')" id="navProducts" style="cursor: pointer;">Products</div>
                <div class="nav-link" onclick="showSection('impact')" id="navImpact" style="cursor: pointer;">Impact</div>
                <div class="nav-link" onclick="showMyProfile()" style="cursor: pointer; display: none;" id="btnMyProfile">My Profile</div>
                <div class="nav-link" onclick="showSection('buyerProfile')" id="navProfile" style="cursor: pointer; display: none;">Profile</div>
            </div>
            <div class="nav-actions">
                <button class="lang-toggle" onclick="toggleLanguage()" id="langToggle">हिं</button>
                <div class="cart-icon" onclick="openCart()">
                    🛒
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
                <div class="notification-icon" onclick="toggleNotifications()">
                    🔔
                    <span class="notification-badge" id="notificationBadge">3</span>
                </div>
                <div class="cart-icon" onclick="toggleWishlist()" style="margin-left: 1rem;">
                    ❤️
                    <span class="cart-badge" id="wishlistBadge">0</span>
                </div>
                <button class="btn-primary" onclick="openRegisterModal()" id="navRegister">Register Shop</button>
            </div>
        </div>
    </nav>

    <!-- PWA Install Banner -->
    <div class="pwa-banner" id="pwaBanner">
        <div class="pwa-info">
            <div class="pwa-icon">📱</div>
            <div>
                <strong>Install BharatBazaar App</strong>
                <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Get quick access and work offline!</p>
            </div>
        </div>
        <div class="pwa-actions">
            <button class="btn-pwa" onclick="dismissPWA()">Later</button>
            <button class="btn-pwa" onclick="installPWA()" style="background: #138808; color: white;">Install</button>
        </div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3 style="margin: 0;">Notifications</h3>
            <button class="modal-close" onclick="toggleNotifications()" style="color: white;">×</button>
        </div>
        <div id="notificationsList"></div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content" style="position: relative; z-index: 1;">
            <h1 id="heroTitle" style="animation: float 3s ease-in-out infinite;">Empowering Local Indian Sellers</h1>
            <p id="heroSubtitle">Connect with neighborhood shops, support local businesses, and build a stronger community</p>
            <div class="sponsor-section">
                <div class="sponsor-badge">
                    <span>🌐</span>
                    <span>Powered by ONDC Protocol</span>
                </div>
                <div class="sponsor-badge">
                    <span>📍</span>
                    <span>LatLong API Integration</span>
                </div>
                <div class="sponsor-badge">
                    <span>✨</span>
                    <span>eSamudaay Compatible</span>
                </div>
            </div>
            <div class="hero-stats" style="animation: slideInUp 0.8s ease 0.3s both;">
                <div class="stat-card">
                    <h3 id="heroStat1">247</h3>
                    <p id="heroStat1Label">Active Sellers</p>
                </div>
                <div class="stat-card">
                    <h3 id="heroStat2">1,834</h3>
                    <p id="heroStat2Label">Happy Buyers</p>
                </div>
                <div class="stat-card">
                    <h3 id="heroStat3">3,421</h3>
                    <p id="heroStat3Label">Orders Completed</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Discover Section -->
        <section id="discover" class="section active" style="display: block;">
            <!-- Flash Deals Banner -->
            <div style="background: linear-gradient(135deg, var(--accent), #F97316); padding: 1.5rem; border-radius: var(--radius); color: white; margin-bottom: 2rem; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <div style="font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.9;">🔥 LIMITED TIME OFFER</div>
                            <h2 style="margin: 0 0 0.5rem 0; font-size: 2rem; color: white;">Flash Deals Near You!</h2>
                            <p style="margin: 0; font-size: 1.1rem; opacity: 0.95;">Up to 30% OFF on selected items • Valid today only!</p>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.25); padding: 1rem 1.5rem; border-radius: var(--radius); backdrop-filter: blur(10px);">
                            <div style="font-size: 0.85rem; margin-bottom: 0.25rem; opacity: 0.9;">Ends in</div>
                            <div id="flashTimer" style="font-size: 2rem; font-weight: bold; font-family: monospace;">05:24:18</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="filters glass">
                <div class="filter-group" style="grid-column: 1 / -1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">Discover Sellers Near You</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span style="color: var(--text-light); font-size: 0.9rem;">Powered by</span>
                            <span style="background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">LatLong API</span>
                        </div>
                    </div>
                </div>
                <div class="filter-group">
                    <label id="labelSearch">Search Location</label>
                    <div class="input-with-icon">
                        <input type="text" class="filter-input" id="searchLocation" placeholder="Enter pincode or area" oninput="searchLocation()">
                        <button class="voice-btn" onclick="startVoiceSearch('location')" title="Voice search">🎤</button>
                    </div>
                </div>
                <div class="filter-group">
                    <label id="labelRadius">Radius</label>
                    <select class="filter-input" id="radiusFilter" onchange="filterSellers()">
                        <option value="all">All</option>
                        <option value="1">1 km</option>
                        <option value="3">3 km</option>
                        <option value="5">5 km</option>
                        <option value="10">10 km</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label id="labelShopType">Shop Type</label>
                    <select class="filter-input" id="typeFilter" onchange="filterSellers()">
                        <option value="all" id="optionAll">All Types</option>
                        <option value="grocery">🛒 Grocery</option>
                        <option value="pharmacy">💊 Pharmacy</option>
                        <option value="electronics">📱 Electronics</option>
                        <option value="clothing">👕 Clothing</option>
                        <option value="restaurant">🍽️ Restaurant</option>
                        <option value="hardware">🔧 Hardware</option>
                    </select>
                </div>
            </div>

            <div id="map" style="position: relative;">
                <div style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: white; padding: 0.75rem 1rem; border-radius: var(--radius-sm); box-shadow: var(--shadow-md); font-size: 0.85rem;">
                    <strong>🗺️ Powered by LatLong API</strong>
                    <div style="color: var(--text-light); margin-top: 0.25rem;">Real-time distance calculations</div>
                </div>
            </div>

            <div class="sellers-grid" id="sellersGrid"></div>
        </section>

        <!-- Products Section -->
        <section id="products" class="section" style="display: none;">
            <div class="products-header glass">
                <div style="margin-bottom: 1rem;">
                    <h2 style="margin-bottom: 0.5rem;">Browse Products</h2>
                    <p style="color: var(--text-light); margin: 0;">Shop from local sellers in your neighborhood</p>
                </div>
                <div class="filter-group">
                    <label id="labelProductSearch">Search Products</label>
                    <div class="input-with-icon" style="position: relative;">
                        <input type="text" class="filter-input" id="searchProducts" placeholder="Search for products..." oninput="filterProductsWithSuggestions()" onfocus="showSearchSuggestions()">
                        <button class="voice-btn" onclick="startVoiceSearch('product')" title="Voice search">🎤</button>
                        <div id="searchSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid var(--primary); border-radius: var(--radius-sm); margin-top: 0.5rem; box-shadow: var(--shadow-lg); z-index: 100; max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button class="btn-secondary" onclick="openAdvancedFilters()" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>🔍</span> Advanced Filters
                    </button>
                    <select class="filter-input" onchange="sortProducts(this.value)" style="max-width: 200px;">
                        <option value="relevance">Sort by: Relevance</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="rating">Highest Rated</option>
                        <option value="discount">Biggest Discount</option>
                    </select>
                </div>
            </div>
            <div class="products-grid" id="productsGrid"></div>
        </section>

        <!-- Seller Dashboard -->
        <section id="sellerDashboard" class="section" style="display: none;">
            <div style="margin-bottom: 2rem;">
                <h2>Seller Dashboard</h2>
                <p style="color: var(--text-light);">Manage your shop, orders, and inventory</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="glass" style="padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">💰</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);">₹0</div>
                    <div style="color: var(--text-light);">Today's Revenue</div>
                </div>
                <div class="glass" style="padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">📦</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">0</div>
                    <div style="color: var(--text-light);">Pending Orders</div>
                </div>
                <div class="glass" style="padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">📊</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent);">0</div>
                    <div style="color: var(--text-light);">Products Listed</div>
                </div>
                <div class="glass" style="padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">⭐</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">0.0</div>
                    <div style="color: var(--text-light);">Average Rating</div>
                </div>
            </div>

            <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>ONDC Integration Status</h3>
                    <button class="btn-primary" onclick="syncONDC()">Sync to ONDC</button>
                </div>
                <div id="ondcStatus" style="padding: 1rem; background: rgba(19, 136, 8, 0.1); border-radius: var(--radius-sm); border-left: 4px solid var(--secondary);">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <span style="font-size: 1.5rem;">✅</span>
                        <strong>Connected to ONDC Network</strong>
                    </div>
                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Your shop is discoverable across 200+ ONDC apps</p>
                </div>
            </div>

            <div class="glass" style="padding: 2rem; border-radius: var(--radius);">
                <h3 style="margin-bottom: 1.5rem;">Quick Actions</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <button class="btn-primary" onclick="addProduct()" style="width: 100%;">📦 Add Product</button>
                    <button class="btn-secondary" onclick="manageInventory()" style="width: 100%;">📋 View Inventory</button>
                    <button class="btn-secondary" onclick="viewOrders()" style="width: 100%;">📦 View Orders</button>
                    <button class="btn-secondary" onclick="viewAnalytics()" style="width: 100%;">📊 Analytics</button>
                </div>
            </div>
        </section>

        <!-- Buyer Profile -->
        <section id="buyerProfile" class="section" style="display: none;">
            <div style="margin-bottom: 2rem;">
                <h2>My Profile</h2>
            </div>

            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); text-align: center;">
                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white;">👤</div>
                        <h3 style="margin-bottom: 0.5rem;">Guest User</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">guest@bharatbazaar.com</p>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <div style="text-align: center;">
                                <div style="font-weight: bold; color: var(--primary);">0</div>
                                <div style="font-size: 0.85rem; color: var(--text-light);">Orders</div>
                            </div>
                            <div style="border-left: 1px solid #E0E0E0; margin: 0 0.5rem;"></div>
                            <div style="text-align: center;">
                                <div style="font-weight: bold; color: var(--secondary);">0</div>
                                <div style="font-size: 0.85rem; color: var(--text-light);">Reviews</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">Order History</h3>
                        <div id="orderHistory" style="text-align: center; padding: 3rem; color: var(--text-light);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📦</div>
                            <p>No orders yet</p>
                            <button class="btn-primary" onclick="showSection('discover')" style="margin-top: 1rem;">Start Shopping</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Checkout Section -->
        <section id="checkout" class="section" style="display: none;">
            <div style="margin-bottom: 2rem;">
                <h2>Checkout</h2>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem;">
                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">Delivery Address</h3>
                        <div id="addressList">
                            <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); border: 2px solid var(--primary); margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <strong>Home</strong>
                                        <p style="margin: 0.5rem 0 0 0; color: var(--text-light);">123 Main Street, New Delhi, 110001</p>
                                    </div>
                                    <input type="radio" name="address" checked>
                                </div>
                            </div>
                            <button class="btn-secondary" style="width: 100%;">➕ Add New Address</button>
                        </div>
                    </div>

                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">Payment Method</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); border: 2px solid var(--primary); cursor: pointer; display: flex; align-items: center; gap: 1rem;">
                                <input type="radio" name="payment" value="upi" checked>
                                <div style="font-size: 1.5rem;">💳</div>
                                <div>
                                    <strong>UPI / QR Code</strong>
                                    <p style="margin: 0; font-size: 0.85rem; color: var(--text-light);">PhonePe, GPay, Paytm</p>
                                </div>
                            </div>
                            <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); border: 2px solid #E0E0E0; cursor: pointer; display: flex; align-items: center; gap: 1rem;">
                                <input type="radio" name="payment" value="card">
                                <div style="font-size: 1.5rem;">💳</div>
                                <div>
                                    <strong>Credit / Debit Card</strong>
                                    <p style="margin: 0; font-size: 0.85rem; color: var(--text-light);">Visa, Mastercard, RuPay</p>
                                </div>
                            </div>
                            <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); border: 2px solid #E0E0E0; cursor: pointer; display: flex; align-items: center; gap: 1rem;">
                                <input type="radio" name="payment" value="cod">
                                <div style="font-size: 1.5rem;">💵</div>
                                <div>
                                    <strong>Cash on Delivery</strong>
                                    <p style="margin: 0; font-size: 0.85rem; color: var(--text-light);">Pay when you receive</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); position: sticky; top: 100px;">
                        <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>
                        <div id="checkoutSummary"></div>
                        <button class="btn-primary" onclick="placeOrder()" style="width: 100%; margin-top: 1.5rem; padding: 1rem; font-size: 1.1rem;">🛍️ Place Order</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Tracking -->
        <section id="orderTracking" class="section" style="display: none;">
            <div style="margin-bottom: 2rem;">
                <h2>Track Your Order</h2>
                <p style="color: var(--text-light);">Order #<span id="trackingOrderId">ORD12345</span></p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem;">
                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">Delivery Status</h3>
                        <div id="orderTimeline"></div>
                    </div>

                    <div class="glass" style="padding: 2rem; border-radius: var(--radius);">
                        <h3 style="margin-bottom: 1.5rem;">Live Tracking</h3>
                        <div id="trackingMap" style="height: 300px; border-radius: var(--radius-sm); background: #E0E0E0; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">📍</div>
                                <p style="color: var(--text-light);">Delivery tracking will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="glass" style="padding: 2rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">Delivery Partner</h3>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white;">🛍️</div>
                            <div>
                                <strong>Rahul Kumar</strong>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Delivery Partner</p>
                            </div>
                        </div>
                        <button class="btn-secondary" style="width: 100%;"><span style="margin-right: 0.5rem;">📞</span>Contact Driver</button>
                    </div>

                    <div class="glass" style="padding: 2rem; border-radius: var(--radius);">
                        <h3 style="margin-bottom: 1.5rem;">Order Items</h3>
                        <div id="trackingItems"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Impact Section -->
        <section id="impact" class="section" style="display: none;">
            <div style="text-align: center; margin-bottom: 3rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Our Impact</h2>
                <p style="color: var(--text-light); font-size: 1.1rem; max-width: 600px; margin: 0 auto;">Building a stronger local economy, one transaction at a time</p>
            </div>
            <div class="impact-grid">
                <div class="impact-card orange">
                    <div class="impact-icon">🏪</div>
                    <div class="impact-value" data-target="247">0</div>
                    <div class="impact-label" id="impactSellers">Sellers Onboarded</div>
                </div>
                <div class="impact-card green">
                    <div class="impact-icon">👥</div>
                    <div class="impact-value" data-target="1834">0</div>
                    <div class="impact-label" id="impactBuyers">Active Buyers</div>
                </div>
                <div class="impact-card blue">
                    <div class="impact-icon">🛒</div>
                    <div class="impact-value" data-target="3421">0</div>
                    <div class="impact-label" id="impactOrders">Orders Completed</div>
                </div>
                <div class="impact-card orange">
                    <div class="impact-icon">🌱</div>
                    <div class="impact-value" data-target="2.8">0</div>
                    <div class="impact-label" id="impactCarbon">KM Carbon Saved</div>
                </div>
                <div class="impact-card green">
                    <div class="impact-icon">💰</div>
                    <div class="impact-value" data-target="5.2">0</div>
                    <div class="impact-label" id="impactRevenue">Lakhs Local Revenue</div>
                </div>
                <div class="impact-card blue">
                    <div class="impact-icon">⭐</div>
                    <div class="impact-value" data-target="4.8">0</div>
                    <div class="impact-label" id="impactRating">Average Rating</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalRegisterTitle">Register Your Shop</h2>
                <button class="modal-close" onclick="closeRegisterModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="progress-indicator">
                    <div class="progress-step active" id="progressStep1">
                        <div class="step-number">1</div>
                        <div class="step-label" id="stepLabel1">Basic Info</div>
                    </div>
                    <div class="progress-step" id="progressStep2">
                        <div class="step-number">2</div>
                        <div class="step-label" id="stepLabel2">Location</div>
                    </div>
                    <div class="progress-step" id="progressStep3">
                        <div class="step-number">3</div>
                        <div class="step-label" id="stepLabel3">Shop Type</div>
                    </div>
                    <div class="progress-step" id="progressStep4">
                        <div class="step-number">4</div>
                        <div class="step-label" id="stepLabel4">Products</div>
                    </div>
                    <div class="progress-step" id="progressStep5">
                        <div class="step-number">5</div>
                        <div class="step-label" id="stepLabel5">Timing</div>
                    </div>
                    <div class="progress-step" id="progressStep6">
                        <div class="step-number">6</div>
                        <div class="step-label" id="stepLabel6">Review</div>
                    </div>
                </div>

                <form id="registerForm">
                    <!-- Step 1: Basic Info -->
                    <div class="form-step active" id="step1">
                        <div class="form-group">
                            <label id="labelShopName">Shop Name</label>
                            <input type="text" id="shopName" required>
                            <div class="form-error">Please enter shop name</div>
                        </div>
                        <div class="form-group">
                            <label id="labelOwnerName">Owner Name</label>
                            <input type="text" id="ownerName" required>
                            <div class="form-error">Please enter owner name</div>
                        </div>
                        <div class="form-group">
                            <label id="labelPhone">Phone Number</label>
                            <input type="tel" id="phone" pattern="[0-9]{10}" maxlength="10" required>
                            <div class="form-error">Please enter valid 10-digit phone number</div>
                        </div>
                    </div>

                    <!-- Step 2: Location -->
                    <div class="form-step" id="step2">
                        <button type="button" class="btn-location" onclick="getLocation()" id="btnGetLocation">
                            📍 Get My Location
                        </button>
                        <div class="location-info" id="locationInfo">
                            <strong id="locationDetected">Location detected:</strong>
                            <p id="locationCoords"></p>
                        </div>
                        <div class="form-group">
                            <label id="labelAddress">Address</label>
                            <textarea id="address" rows="3" required></textarea>
                            <div class="form-error">Please enter address</div>
                        </div>
                        <div class="form-group">
                            <label id="labelPincode">Pincode</label>
                            <input type="text" id="pincode" pattern="[0-9]{6}" maxlength="6" required>
                            <div class="form-error">Please enter valid 6-digit pincode</div>
                        </div>
                    </div>

                    <!-- Step 3: Shop Type -->
                    <div class="form-step" id="step3">
                        <div class="form-group">
                            <label id="labelSelectShopType">Select Shop Type</label>
                            <div class="shop-types-grid" id="shopTypesGrid"></div>
                            <input type="hidden" id="shopType" required>
                            <div class="form-error">Please select a shop type</div>
                        </div>
                        <div class="form-group">
                            <label id="labelProducts">Products/Services</label>
                            <textarea id="productsServices" rows="4" placeholder="List your products or services..." required></textarea>
                            <div class="form-error">Please describe your products/services</div>
                        </div>
                    </div>

                    <!-- Step 4: Products -->
                    <div class="form-step" id="step4">
                        <div class="form-group">
                            <label id="labelProducts">Products/Services</label>
                            <textarea id="productsServices" rows="4" placeholder="List your main products or services..." required></textarea>
                            <div class="form-error">Please describe your products/services</div>
                        </div>
                        <div class="form-group">
                            <label id="labelMinOrder">Minimum Order Amount (₹)</label>
                            <input type="number" id="minOrder" value="50" min="0">
                        </div>
                        <div class="form-group">
                            <label id="labelDeliveryFee">Delivery Fee (₹)</label>
                            <input type="number" id="deliveryFee" value="20" min="0">
                        </div>
                    </div>

                    <!-- Step 5: Timing -->
                    <div class="form-step" id="step5">
                        <div class="form-group">
                            <label id="labelOpenTime">Opening Time</label>
                            <input type="time" id="openTime" value="09:00" required>
                            <div class="form-error">Please select opening time</div>
                        </div>
                        <div class="form-group">
                            <label id="labelCloseTime">Closing Time</label>
                            <input type="time" id="closeTime" value="21:00" required>
                            <div class="form-error">Please select closing time</div>
                        </div>
                        <div class="form-group">
                            <label id="labelDeliveryRadius">Delivery Radius (km)</label>
                            <input type="range" id="deliveryRadius" min="1" max="10" value="3" oninput="updateRadiusDisplay(this.value)">
                            <div style="text-align: center; color: var(--primary); font-weight: bold; margin-top: 0.5rem;">
                                <span id="radiusDisplay">3</span> km
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Review -->
                    <div class="form-step" id="step6">
                        <div style="background: var(--background); padding: 1.5rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 1rem; color: var(--primary);">Review Your Information</h4>
                            <div id="reviewSummary"></div>
                        </div>
                        <div style="padding: 1rem; background: rgba(19, 136, 8, 0.1); border-radius: var(--radius-sm); border-left: 4px solid var(--secondary);">
                            <strong>✅ ONDC Integration</strong>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: var(--text-light);">Your shop will be automatically listed on the ONDC network</p>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="btnPrev" onclick="previousStep()" style="display: none;">Previous</button>
                        <button type="button" class="btn-primary" id="btnNext" onclick="nextStep()">Next</button>
                        <button type="submit" class="btn-primary" id="btnSubmit" style="display: none;">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalCartTitle">Shopping Cart</h2>
                <button class="modal-close" onclick="closeCart()">×</button>
            </div>
            <div class="modal-body">
                <div id="cartContent"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: linear-gradient(135deg, var(--accent), var(--primary)); color: var(--white); padding: 3rem 2rem 2rem; margin-top: 4rem;">
        <div class="container">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                <div>
                    <h3 style="margin-bottom: 1rem; font-size: 1.5rem;">BharatBazaar OSS</h3>
                    <p style="opacity: 0.9; line-height: 1.8;">Empowering local Indian sellers through open-source technology and hyperlocal commerce.</p>
                    <div style="margin-top: 1rem; display: flex; gap: 1rem; font-size: 1.5rem;">
                        <a href="#" style="color: white; opacity: 0.8; transition: var(--transition);" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">👥</a>
                        <a href="#" style="color: white; opacity: 0.8; transition: var(--transition);" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">🐦</a>
                        <a href="#" style="color: white; opacity: 0.8; transition: var(--transition);" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">📸</a>
                    </div>
                </div>
                <div>
                    <h4 style="margin-bottom: 1rem;">Quick Links</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; opacity: 0.9;">
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">About Us</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">How It Works</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">For Sellers</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">For Buyers</a>
                    </div>
                </div>
                <div>
                    <h4 style="margin-bottom: 1rem;">Support</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; opacity: 0.9;">
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Help Center</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Contact Us</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Privacy Policy</a>
                        <a href="#" style="color: white; text-decoration: none; transition: var(--transition);" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Terms of Service</a>
                    </div>
                </div>
                <div>
                    <h4 style="margin-bottom: 1rem;">Download App</h4>
                    <p style="opacity: 0.9; margin-bottom: 1rem;">Get the mobile experience</p>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn-pwa" style="width: 100%; display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                            <span>🍎</span> App Store
                        </button>
                        <button class="btn-pwa" style="width: 100%; display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                            <span>🤖</span> Play Store
                        </button>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 2rem; text-align: center;">
                <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-bottom: 1rem; opacity: 0.9;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>🌐</span>
                        <span>Powered by ONDC Protocol</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>📍</span>
                        <span>LatLong Distance Matrix API</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>✨</span>
                        <span>eSamudaay Compatible</span>
                    </div>
                </div>
                <p style="opacity: 0.8; margin: 0;">© 2025 BharatBazaar OSS. 100% Open Source. Built for India.</p>
            </div>
        </div>
    </footer>

    <!-- Product Detail Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="productModalTitle">Product Details</h2>
                <button class="modal-close" onclick="closeProductModal()">×</button>
            </div>
            <div class="modal-body" id="productModalBody">
            </div>
        </div>
    </div>

    <!-- Seller Detail Modal -->
    <div class="modal" id="sellerModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 id="sellerModalTitle">Seller Details</h2>
                <button class="modal-close" onclick="closeSellerModal()">×</button>
            </div>
            <div class="modal-body" id="sellerModalBody">
            </div>
        </div>
    </div>

    <!-- Advanced Filters Modal -->
    <div class="modal" id="filtersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Advanced Filters</h2>
                <button class="modal-close" onclick="closeAdvancedFilters()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Price Range</label>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <input type="range" id="priceMin" min="0" max="60000" value="0" step="100" style="flex: 1;" oninput="updatePriceDisplay()">
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; color: var(--primary); font-weight: 600;">
                        <span>₹<span id="priceMinDisplay">0</span></span>
                        <span>₹<span id="priceMaxDisplay">60000</span></span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Minimum Rating</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="filter-chip" onclick="setRatingFilter(0, this)">All</button>
                        <button class="filter-chip" onclick="setRatingFilter(4, this)">4★ & above</button>
                        <button class="filter-chip" onclick="setRatingFilter(3, this)">3★ & above</button>
                    </div>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="filterOpenNow" onchange="applyAdvancedFilters()">
                        Open Now Only
                    </label>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="filterFreeDelivery" onchange="applyAdvancedFilters()">
                        Free Delivery Only
                    </label>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="clearAllFilters()">Clear All</button>
                    <button class="btn-primary" onclick="applyAdvancedFilters()">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div class="modal" id="compareModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2>Product Comparison</h2>
                <button class="modal-close" onclick="closeCompareModal()">×</button>
            </div>
            <div class="modal-body" id="compareModalBody">
            </div>
        </div>
    </div>

    <!-- Wishlist Modal -->
    <div class="modal" id="wishlistModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>My Wishlist</h2>
                <button class="modal-close" onclick="closeWishlist()">×</button>
            </div>
            <div class="modal-body" id="wishlistContent">
            </div>
        </div>
    </div>

    <!-- Store Detail Modal with Product Grid -->
    <div class="modal" id="storeDetailModal">
        <div class="modal-content" style="max-width: 1400px; max-height: 95vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="storeDetailTitle">Store Details</h2>
                <button class="modal-close" onclick="closeStoreDetail()">×</button>
            </div>
            <div class="modal-body" id="storeDetailBody">
            </div>
        </div>
    </div>

    <!-- Route Navigation Modal -->
    <div class="modal" id="routeModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>🗺️ Get Directions</h2>
                <button class="modal-close" onclick="closeRouteModal()">×</button>
            </div>
            <div class="modal-body" id="routeModalBody">
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Write a Review</h2>
                <button class="modal-close" onclick="closeReviewModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Your Rating</label>
                    <div style="font-size: 2rem; display: flex; gap: 0.5rem;" id="ratingStars">
                        <span onclick="setRating(1)" style="cursor: pointer; color: #ddd;">★</span>
                        <span onclick="setRating(2)" style="cursor: pointer; color: #ddd;">★</span>
                        <span onclick="setRating(3)" style="cursor: pointer; color: #ddd;">★</span>
                        <span onclick="setRating(4)" style="cursor: pointer; color: #ddd;">★</span>
                        <span onclick="setRating(5)" style="cursor: pointer; color: #ddd;">★</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Your Review</label>
                    <textarea id="reviewText" rows="4" placeholder="Share your experience..."></textarea>
                </div>
                <input type="hidden" id="reviewItemId">
                <input type="hidden" id="reviewRating" value="5">
                <div class="form-actions">
                    <button class="btn-secondary" onclick="closeReviewModal()">Cancel</button>
                    <button class="btn-primary" onclick="submitReview()">Submit Review</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-content">
                <div class="success-icon">✓</div>
                <h2 id="successTitle">Success!</h2>
                <p id="successMessage">Your shop has been registered successfully!</p>
                <div class="qr-placeholder">📱</div>
                <p id="successQRText">Your shop QR code</p>
                <button class="btn-primary" onclick="closeSuccessModal()" id="btnClose">Go to Dashboard</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script>
        // Data
        let currentLanguage = 'en';
        let currentStep = 1;
        let userLocation = { lat: 28.6139, lng: 77.2090 };
        let cart = [];
        let wishlist = [];
        let compareList = [];
        let reviews = {};
        let searchHistory = [];
        let map = null;
        let markers = null;

        // State
        let currentUser = null;
        let notifications = [
            { id: 1, type: 'order', icon: '📦', title: 'New Order Received', message: 'You have a new order from Sharma General Store', time: '2 mins ago', unread: true },
            { id: 2, type: 'seller', icon: '🏪', title: 'New Seller Nearby', message: 'Kumar Electronics opened near you', time: '1 hour ago', unread: true },
            { id: 3, type: 'price', icon: '🏷️', title: 'Price Drop Alert', message: 'Basmati Rice now at ₹225', time: '3 hours ago', unread: false }
        ];
        
        const sellers = [
            { id: 1, name: "Sharma General Store", type: "grocery", lat: 28.6129, lng: 77.2295, phone: "+91 98765 43210", products: ["Rice", "Dal", "Snacks", "Beverages"], rating: 4.5, verified: true, distance: 0.2 },
            { id: 2, name: "Patel Medical", type: "pharmacy", lat: 28.6149, lng: 77.2195, phone: "+91 98765 43211", products: ["Medicines", "First Aid", "Healthcare"], rating: 4.8, verified: true, distance: 0.5 },
            { id: 3, name: "Kumar Electronics", type: "electronics", lat: 28.6189, lng: 77.2390, phone: "+91 98765 43212", products: ["Mobile", "TV", "Appliances"], rating: 4.3, verified: true, distance: 0.8 },
            { id: 4, name: "Fashion Hub", type: "clothing", lat: 28.6109, lng: 77.2195, phone: "+91 98765 43213", products: ["Shirts", "Jeans", "Sarees", "Accessories"], rating: 4.6, verified: false, distance: 1.2 },
            { id: 5, name: "Spice Kitchen", type: "restaurant", lat: 28.6159, lng: 77.2295, phone: "+91 98765 43214", products: ["Biryani", "Curry", "Thali", "Snacks"], rating: 4.7, verified: true, distance: 0.4 },
            { id: 6, name: "Tools & Hardware", type: "hardware", lat: 28.6179, lng: 77.2095, phone: "+91 98765 43215", products: ["Tools", "Paint", "Electrical", "Plumbing"], rating: 4.4, verified: true, distance: 1.5 },
            { id: 7, name: "Green Organic Store", type: "grocery", lat: 28.6199, lng: 77.2205, phone: "+91 98765 43216", products: ["Organic Vegetables", "Fruits", "Grains"], rating: 4.6, verified: true, distance: 0.7 },
            { id: 8, name: "Mobile Zone", type: "electronics", lat: 28.6119, lng: 77.2305, phone: "+91 98765 43217", products: ["Smartphones", "Accessories", "Repairs"], rating: 4.5, verified: true, distance: 0.9 },
            { id: 9, name: "Fashion Point", type: "clothing", lat: 28.6169, lng: 77.2205, phone: "+91 98765 43218", products: ["Ethnic Wear", "Western", "Kids"], rating: 4.7, verified: false, distance: 0.6 },
            { id: 10, name: "Cafe Delight", type: "restaurant", lat: 28.6139, lng: 77.2395, phone: "+91 98765 43219", products: ["Coffee", "Snacks", "Sandwiches"], rating: 4.4, verified: true, distance: 1.1 },
            { id: 11, name: "Singh Pharmacy", type: "pharmacy", lat: 28.6089, lng: 77.2255, phone: "+91 98765 43220", products: ["Medicines", "Wellness"], rating: 4.7, verified: true, distance: 0.5 },
            { id: 12, name: "Verma Sweets", type: "restaurant", lat: 28.6209, lng: 77.2155, phone: "+91 98765 43221", products: ["Sweets", "Snacks"], rating: 4.8, verified: true, distance: 1.3 },
            { id: 13, name: "Tech World", type: "electronics", lat: 28.6099, lng: 77.2425, phone: "+91 98765 43222", products: ["Laptops", "Tablets"], rating: 4.6, verified: true, distance: 1.8 },
            { id: 14, name: "Style Studio", type: "clothing", lat: 28.6229, lng: 77.2275, phone: "+91 98765 43223", products: ["Fashion", "Accessories"], rating: 4.5, verified: false, distance: 2.1 },
            { id: 15, name: "Daily Needs Store", type: "grocery", lat: 28.6079, lng: 77.2185, phone: "+91 98765 43224", products: ["Groceries", "Essentials"], rating: 4.4, verified: true, distance: 0.8 },
            { id: 16, name: "Book Haven", type: "hardware", lat: 28.6189, lng: 77.2135, phone: "+91 98765 43225", products: ["Books", "Stationery"], rating: 4.9, verified: true, distance: 1.0 },
            { id: 17, name: "Fresh Vegetables", type: "grocery", lat: 28.6149, lng: 77.2445, phone: "+91 98765 43226", products: ["Vegetables", "Fruits"], rating: 4.6, verified: true, distance: 1.4 },
            { id: 18, name: "Pizza Corner", type: "restaurant", lat: 28.6069, lng: 77.2335, phone: "+91 98765 43227", products: ["Pizza", "Pasta"], rating: 4.7, verified: true, distance: 1.7 },
            { id: 19, name: "Fitness Store", type: "hardware", lat: 28.6219, lng: 77.2055, phone: "+91 98765 43228", products: ["Gym Equipment", "Supplements"], rating: 4.5, verified: true, distance: 2.3 },
            { id: 20, name: "Baby Care Shop", type: "pharmacy", lat: 28.6059, lng: 77.2215, phone: "+91 98765 43229", products: ["Baby Products", "Toys"], rating: 4.8, verified: true, distance: 0.6 },
            { id: 21, name: "Gupta Bakery", type: "restaurant", lat: 28.6239, lng: 77.2345, phone: "+91 98765 43230", products: ["Cakes", "Pastries", "Bread"], rating: 4.6, verified: true, distance: 1.9 },
            { id: 22, name: "Royal Tailors", type: "clothing", lat: 28.6049, lng: 77.2275, phone: "+91 98765 43231", products: ["Stitching", "Alterations"], rating: 4.7, verified: true, distance: 0.4 },
            { id: 23, name: "Fresh Juice Bar", type: "restaurant", lat: 28.6169, lng: 77.2465, phone: "+91 98765 43232", products: ["Juices", "Smoothies"], rating: 4.5, verified: true, distance: 1.6 },
            { id: 24, name: "Shoe Palace", type: "clothing", lat: 28.6199, lng: 77.2085, phone: "+91 98765 43233", products: ["Shoes", "Sandals"], rating: 4.4, verified: false, distance: 2.0 },
            { id: 25, name: "Mobile Repair Shop", type: "electronics", lat: 28.6089, lng: 77.2415, phone: "+91 98765 43234", products: ["Repairs", "Accessories"], rating: 4.6, verified: true, distance: 1.5 },
            { id: 26, name: "Pet Store", type: "hardware", lat: 28.6129, lng: 77.2055, phone: "+91 98765 43235", products: ["Pet Food", "Accessories"], rating: 4.8, verified: true, distance: 1.2 },
            { id: 27, name: "Optical Store", type: "pharmacy", lat: 28.6209, lng: 77.2435, phone: "+91 98765 43236", products: ["Eyeglasses", "Lenses"], rating: 4.7, verified: true, distance: 2.2 },
            { id: 28, name: "Tea Stall", type: "restaurant", lat: 28.6099, lng: 77.2165, phone: "+91 98765 43237", products: ["Tea", "Snacks"], rating: 4.3, verified: false, distance: 0.7 },
            { id: 29, name: "Flower Shop", type: "grocery", lat: 28.6189, lng: 77.2505, phone: "+91 98765 43238", products: ["Flowers", "Bouquets"], rating: 4.9, verified: true, distance: 2.4 },
            { id: 30, name: "Ayurvedic Store", type: "pharmacy", lat: 28.6069, lng: 77.2145, phone: "+91 98765 43239", products: ["Ayurvedic Medicines"], rating: 4.6, verified: true, distance: 0.9 }
        ];

        // Enhanced mock data
        const mockOrders = [];
        
        const products = [
            { id: 1, name: "Basmati Rice (5kg)", seller: "Sharma General Store", price: 200, icon: "🍚", sellerId: 1 },
            { id: 2, name: "Toor Dal (1kg)", seller: "Sharma General Store", price: 75, icon: "🫘", sellerId: 1 },
            { id: 3, name: "Paracetamol Tablets", seller: "Patel Medical", price: 12, icon: "💊", sellerId: 2 },
            { id: 4, name: "First Aid Kit", seller: "Patel Medical", price: 200, icon: "🩹", sellerId: 2 },
            { id: 5, name: "Samsung Mobile", seller: "Kumar Electronics", price: 6000, icon: "📱", sellerId: 3 },
            { id: 6, name: "LED TV 32inch", seller: "Kumar Electronics", price: 4000, icon: "📺", sellerId: 3 },
            { id: 7, name: "Cotton Shirt", seller: "Fashion Hub", price: 250, icon: "👕", sellerId: 4 },
            { id: 8, name: "Designer Saree", seller: "Fashion Hub", price: 2000, icon: "🥻", sellerId: 4 },
            { id: 9, name: "Chicken Biryani", seller: "Spice Kitchen", price: 120, icon: "🍛", sellerId: 5 },
            { id: 10, name: "Paneer Thali", seller: "Spice Kitchen", price: 75, icon: "🍽️", sellerId: 5 },
            { id: 11, name: "Drill Machine", seller: "Tools & Hardware", price: 600, icon: "🔨", sellerId: 6 },
            { id: 12, name: "Paint Bucket", seller: "Tools & Hardware", price: 300, icon: "🎨", sellerId: 6 },
            { id: 13, name: "Fresh Tomatoes (1kg)", seller: "Green Organic Store", price: 30, icon: "🍅", sellerId: 7 },
            { id: 14, name: "Organic Honey (500g)", seller: "Green Organic Store", price: 200, icon: "🍯", sellerId: 7 },
            { id: 15, name: "iPhone 13", seller: "Mobile Zone", price: 20000, icon: "📱", sellerId: 8 },
            { id: 16, name: "Wireless Earbuds", seller: "Mobile Zone", price: 2000, icon: "🎧", sellerId: 8 },
            { id: 17, name: "Kurti Set", seller: "Fashion Point", price: 1000, icon: "👗", sellerId: 9 },
            { id: 18, name: "Jeans", seller: "Fashion Point", price: 300, icon: "👖", sellerId: 9 },
            { id: 19, name: "Cappuccino", seller: "Cafe Delight", price: 75, icon: "☕", sellerId: 10 },
            { id: 20, name: "Sandwich", seller: "Cafe Delight", price: 30, icon: "🥪", sellerId: 10 },
            { id: 21, name: "Cough Syrup", seller: "Singh Pharmacy", price: 40, icon: "💊", sellerId: 11 },
            { id: 22, name: "Vitamin C Tablets", seller: "Singh Pharmacy", price: 75, icon: "💊", sellerId: 11 },
            { id: 23, name: "Gulab Jamun (1kg)", seller: "Verma Sweets", price: 200, icon: "🍮", sellerId: 12 },
            { id: 24, name: "Samosa (6 pcs)", seller: "Verma Sweets", price: 30, icon: "🥟", sellerId: 12 },
            { id: 25, name: "Dell Laptop", seller: "Tech World", price: 30000, icon: "💻", sellerId: 13 },
            { id: 26, name: "iPad Air", seller: "Tech World", price: 56000, icon: "📱", sellerId: 13 },
            { id: 27, name: "Party Dress", seller: "Style Studio", price: 2000, icon: "👗", sellerId: 14 },
            { id: 28, name: "Handbag", seller: "Style Studio", price: 600, icon: "👜", sellerId: 14 },
            { id: 29, name: "Atta (10kg)", seller: "Daily Needs Store", price: 380, icon: "🌾", sellerId: 15 },
            { id: 30, name: "Cooking Oil (1L)", seller: "Daily Needs Store", price: 75, icon: "🧈", sellerId: 15 },
            { id: 31, name: "Novel Book", seller: "Book Haven", price: 200, icon: "📖", sellerId: 16 },
            { id: 32, name: "Notebook Set", seller: "Book Haven", price: 75, icon: "📓", sellerId: 16 },
            { id: 33, name: "Fresh Spinach (500g)", seller: "Fresh Vegetables", price: 25, icon: "🥬", sellerId: 17 },
            { id: 34, name: "Banana (1 dozen)", seller: "Fresh Vegetables", price: 30, icon: "🍌", sellerId: 17 },
            { id: 35, name: "Margherita Pizza", seller: "Pizza Corner", price: 200, icon: "🍕", sellerId: 18 },
            { id: 36, name: "Pasta Alfredo", seller: "Pizza Corner", price: 200, icon: "🍝", sellerId: 18 },
            { id: 37, name: "Dumbbell Set", seller: "Fitness Store", price: 950, icon: "🏋️", sellerId: 19 },
            { id: 38, name: "Yoga Mat", seller: "Fitness Store", price: 300, icon: "🧘", sellerId: 19 },
            { id: 39, name: "Baby Diapers", seller: "Baby Care Shop", price: 300, icon: "🚼", sellerId: 20 },
            { id: 40, name: "Baby Food", seller: "Baby Care Shop", price: 200, icon: "🍼", sellerId: 20 },
            { id: 41, name: "Bread (400g)", seller: "Sharma General Store", price: 30, icon: "🍞", sellerId: 1 },
            { id: 42, name: "Milk (1L)", seller: "Sharma General Store", price: 40, icon: "🥛", sellerId: 1 },
            { id: 43, name: "Eggs (12 pcs)", seller: "Sharma General Store", price: 40, icon: "🥚", sellerId: 1 },
            { id: 44, name: "Butter (100g)", seller: "Daily Needs Store", price: 52, icon: "🧈", sellerId: 15 },
            { id: 45, name: "Cheese Slice", seller: "Daily Needs Store", price: 75, icon: "🧀", sellerId: 15 },
            { id: 46, name: "Tea Powder (250g)", seller: "Sharma General Store", price: 75, icon: "☕", sellerId: 1 },
            { id: 47, name: "Coffee Powder (200g)", seller: "Daily Needs Store", price: 120, icon: "☕", sellerId: 15 },
            { id: 48, name: "Sugar (1kg)", seller: "Sharma General Store", price: 30, icon: "🍬", sellerId: 1 },
            { id: 49, name: "Salt (1kg)", seller: "Daily Needs Store", price: 20, icon: "🧂", sellerId: 15 },
            { id: 50, name: "Face Mask (50pcs)", seller: "Patel Medical", price: 200, icon: "😷", sellerId: 2 },
            { id: 51, name: "Hand Sanitizer", seller: "Singh Pharmacy", price: 30, icon: "🧼", sellerId: 11 },
            { id: 52, name: "Band-Aid Pack", seller: "Patel Medical", price: 30, icon: "🩹", sellerId: 2 },
            { id: 53, name: "Pain Relief Gel", seller: "Singh Pharmacy", price: 100, icon: "💊", sellerId: 11 },
            { id: 54, name: "Thermometer", seller: "Patel Medical", price: 200, icon: "🌡️", sellerId: 2 },
            { id: 55, name: "OnePlus Nord", seller: "Kumar Electronics", price: 20000, icon: "📱", sellerId: 3 },
            { id: 56, name: "Realme 10", seller: "Mobile Zone", price: 6000, icon: "📱", sellerId: 8 },
            { id: 57, name: "Smart Watch", seller: "Tech World", price: 3499, icon: "⌚", sellerId: 13 },
            { id: 58, name: "Bluetooth Speaker", seller: "Kumar Electronics", price: 1000, icon: "🔊", sellerId: 3 },
            { id: 59, name: "Power Bank 10000mAh", seller: "Mobile Zone", price: 400, icon: "🔋", sellerId: 8 },
            { id: 60, name: "USB Cable", seller: "Tech World", price: 149, icon: "🔌", sellerId: 13 },
            { id: 61, name: "Men's T-Shirt", seller: "Fashion Hub", price: 250, icon: "👕", sellerId: 4 },
            { id: 62, name: "Women's Top", seller: "Fashion Point", price: 699, icon: "👚", sellerId: 9 },
            { id: 63, name: "Formal Shirt", seller: "Style Studio", price: 400, icon: "👔", sellerId: 14 },
            { id: 64, name: "Casual Shoes", seller: "Fashion Hub", price: 1000, icon: "👟", sellerId: 4 },
            { id: 65, name: "Sports Shoes", seller: "Fashion Point", price: 950, icon: "👟", sellerId: 9 },
            { id: 66, name: "Belt", seller: "Style Studio", price: 300, icon: "🎀", sellerId: 14 },
            { id: 67, name: "Wallet", seller: "Fashion Hub", price: 250, icon: "👛", sellerId: 4 },
            { id: 68, name: "Masala Dosa", seller: "Spice Kitchen", price: 30, icon: "🥞", sellerId: 5 },
            { id: 69, name: "Idli Sambhar", seller: "Spice Kitchen", price: 30, icon: "🍚", sellerId: 5 },
            { id: 70, name: "Veg Thali", seller: "Spice Kitchen", price: 40, icon: "🍛", sellerId: 5 },
            { id: 71, name: "Burger Combo", seller: "Cafe Delight", price: 120, icon: "🍔", sellerId: 10 },
            { id: 72, name: "French Fries", seller: "Cafe Delight", price: 30, icon: "🍟", sellerId: 10 },
            { id: 73, name: "Cold Coffee", seller: "Cafe Delight", price: 100, icon: "🧃", sellerId: 10 },
            { id: 74, name: "Pav Bhaji", seller: "Verma Sweets", price: 40, icon: "🍛", sellerId: 12 },
            { id: 75, name: "Chole Bhature", seller: "Verma Sweets", price: 100, icon: "🍛", sellerId: 12 },
            { id: 76, name: "Jalebi (250g)", seller: "Verma Sweets", price: 75, icon: "🍩", sellerId: 12 },
            { id: 77, name: "Rasgulla (1kg)", seller: "Verma Sweets", price: 380, icon: "🍮", sellerId: 12 },
            { id: 78, name: "Screwdriver Set", seller: "Tools & Hardware", price: 200, icon: "🔧", sellerId: 6 },
            { id: 79, name: "Hammer", seller: "Tools & Hardware", price: 180, icon: "🔨", sellerId: 6 },
            { id: 80, name: "Measuring Tape", seller: "Tools & Hardware", price: 75, icon: "📐", sellerId: 6 },
            { id: 81, name: "LED Bulb (Pack of 4)", seller: "Tools & Hardware", price: 200, icon: "💡", sellerId: 6 },
            { id: 82, name: "Extension Cord", seller: "Tools & Hardware", price: 180, icon: "🔌", sellerId: 6 },
            { id: 83, name: "Wall Paint (1L)", seller: "Tools & Hardware", price: 300, icon: "🎨", sellerId: 6 },
            { id: 84, name: "Potatoes (1kg)", seller: "Fresh Vegetables", price: 30, icon: "🥔", sellerId: 17 },
            { id: 85, name: "Onions (1kg)", seller: "Fresh Vegetables", price: 30, icon: "🧅", sellerId: 17 },
            { id: 86, name: "Carrots (500g)", seller: "Fresh Vegetables", price: 28, icon: "🥕", sellerId: 17 },
            { id: 87, name: "Apples (1kg)", seller: "Fresh Vegetables", price: 75, icon: "🍎", sellerId: 17 },
            { id: 88, name: "Oranges (1kg)", seller: "Fresh Vegetables", price: 30, icon: "🍊", sellerId: 17 },
            { id: 89, name: "Chicken Tikka Pizza", seller: "Pizza Corner", price: 349, icon: "🍕", sellerId: 18 },
            { id: 90, name: "Garlic Bread", seller: "Pizza Corner", price: 75, icon: "🥖", sellerId: 18 },
            { id: 91, name: "Pasta Arrabiata", seller: "Pizza Corner", price: 150, icon: "🍝", sellerId: 18 },
            { id: 92, name: "Protein Powder", seller: "Fitness Store", price: 2000, icon: "🥤", sellerId: 19 },
            { id: 93, name: "Resistance Bands", seller: "Fitness Store", price: 200, icon: "🏋️", sellerId: 19 },
            { id: 94, name: "Skipping Rope", seller: "Fitness Store", price: 200, icon: "🤸", sellerId: 19 },
            { id: 95, name: "Baby Wipes", seller: "Baby Care Shop", price: 120, icon: "🧽", sellerId: 20 },
            { id: 96, name: "Baby Powder", seller: "Baby Care Shop", price: 75, icon: "🍼", sellerId: 20 },
            { id: 97, name: "Feeding Bottle", seller: "Baby Care Shop", price: 200, icon: "🍼", sellerId: 20 },
            { id: 98, name: "Notebook A4 (5pc)", seller: "Book Haven", price: 200, icon: "📓", sellerId: 16 },
            { id: 99, name: "Pen Set (10pc)", seller: "Book Haven", price: 75, icon: "✏️", sellerId: 16 },
            { id: 100, name: "School Bag", seller: "Book Haven", price: 400, icon: "🎒", sellerId: 16 }
        ];

        const shopTypes = [
            { type: "grocery", icon: "🛒", label_en: "Grocery", label_hi: "किराना" },
            { type: "pharmacy", icon: "💊", label_en: "Pharmacy", label_hi: "फार्मेसी" },
            { type: "electronics", icon: "📱", label_en: "Electronics", label_hi: "इलेक्ट्रॉनिक्स" },
            { type: "clothing", icon: "👕", label_en: "Clothing", label_hi: "कपड़े" },
            { type: "restaurant", icon: "🍽️", label_en: "Restaurant", label_hi: "रेस्तरां" },
            { type: "hardware", icon: "🔧", label_en: "Hardware", label_hi: "हार्डवेयर" }
        ];

        const translations = {
            appName: { en: "BharatBazaar OSS", hi: "भारतबाज़ार ओएसएस" },
            heroTitle: { en: "Empowering Local Indian Sellers", hi: "स्थानीय भारतीय विक्रेताओं को सशक्त बनाना" },
            heroSubtitle: { en: "Connect with neighborhood shops, support local businesses, and build a stronger community", hi: "पड़ोस की दुकानों से जुड़ें, स्थानीय व्यवसायों का समर्थन करें और एक मजबूत समुदाय बनाएं" },
            navDiscover: { en: "Discover", hi: "खोजें" },
            navProducts: { en: "Products", hi: "उत्पाद" },
            navImpact: { en: "Impact", hi: "प्रभाव" },
            navRegister: { en: "Register Shop", hi: "दुकान पंजीकृत करें" },
            heroStat1Label: { en: "Active Sellers", hi: "सक्रिय विक्रेता" },
            heroStat2Label: { en: "Happy Buyers", hi: "खुश खरीदार" },
            heroStat3Label: { en: "Orders Completed", hi: "पूर्ण ऑर्डर" },
            labelSearch: { en: "Search Location", hi: "स्थान खोजें" },
            labelRadius: { en: "Radius", hi: "त्रिज्या" },
            labelShopType: { en: "Shop Type", hi: "दुकान का प्रकार" },
            optionAll: { en: "All Types", hi: "सभी प्रकार" },
            labelProductSearch: { en: "Search Products", hi: "उत्पाद खोजें" },
            impactSellers: { en: "Sellers Onboarded", hi: "विक्रेता ऑनबोर्ड किए गए" },
            impactBuyers: { en: "Active Buyers", hi: "सक्रिय खरीदार" },
            impactOrders: { en: "Orders Completed", hi: "पूर्ण ऑर्डर" },
            impactCarbon: { en: "KM Carbon Saved", hi: "किमी कार्बन बचा" },
            impactRevenue: { en: "Lakhs Local Revenue", hi: "लाख स्थानीय राजस्व" },
            impactRating: { en: "Average Rating", hi: "औसत रेटिंग" },
            modalRegisterTitle: { en: "Register Your Shop", hi: "अपनी दुकान पंजीकृत करें" },
            stepLabel1: { en: "Basic Info", hi: "बुनियादी जानकारी" },
            stepLabel2: { en: "Location", hi: "स्थान" },
            stepLabel3: { en: "Details", hi: "विवरण" },
            labelShopName: { en: "Shop Name", hi: "दुकान का नाम" },
            labelOwnerName: { en: "Owner Name", hi: "मालिक का नाम" },
            labelPhone: { en: "Phone Number", hi: "फ़ोन नंबर" },
            btnGetLocation: { en: "📍 Get My Location", hi: "📍 मेरा स्थान प्राप्त करें" },
            locationDetected: { en: "Location detected:", hi: "स्थान का पता लगा:" },
            labelAddress: { en: "Address", hi: "पता" },
            labelPincode: { en: "Pincode", hi: "पिनकोड" },
            labelSelectShopType: { en: "Select Shop Type", hi: "दुकान का प्रकार चुनें" },
            labelProducts: { en: "Products/Services", hi: "उत्पाद/सेवाएं" },
            btnPrev: { en: "Previous", hi: "पिछला" },
            btnNext: { en: "Next", hi: "अगला" },
            btnSubmit: { en: "Submit", hi: "जमा करें" },
            modalCartTitle: { en: "Shopping Cart", hi: "शॉपिंग कार्ट" },
            successTitle: { en: "Success!", hi: "सफलता!" },
            successMessage: { en: "Your shop has been registered successfully!", hi: "आपकी दुकान सफलतापूर्वक पंजीकृत हो गई है!" },
            successQRText: { en: "Your shop QR code", hi: "आपकी दुकान का QR कोड" },
            btnClose: { en: "Close", hi: "बंद करें" },
            emptyCart: { en: "Your cart is empty", hi: "आपकी कार्ट खाली है" },
            addToCart: { en: "Add to Cart", hi: "कार्ट में जोड़ें" },
            subtotal: { en: "Subtotal", hi: "उप-योग" },
            checkout: { en: "Proceed to Checkout", hi: "चेकआउट के लिए आगे बढ़ें" },
            distance: { en: "km away", hi: "किमी दूर" },
            phone: { en: "Phone", hi: "फ़ोन" },
            viewProducts: { en: "View Products", hi: "उत्पाद देखें" }
        };

        // Utility Functions
        function updateRadiusDisplay(value) {
            document.getElementById('radiusDisplay').textContent = value;
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                renderNotifications();
            }
        }

        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            list.innerHTML = '';
            
            notifications.forEach(notif => {
                const item = document.createElement('div');
                item.className = `notification-item ${notif.unread ? 'unread' : ''}`;
                item.innerHTML = `
                    <div class="notification-icon-type">${notif.icon}</div>
                    <div style="flex: 1;">
                        <strong>${notif.title}</strong>
                        <p style="margin: 0.25rem 0 0 0; color: var(--text-light); font-size: 0.9rem;">${notif.message}</p>
                        <p style="margin: 0.5rem 0 0 0; color: var(--text-light); font-size: 0.8rem;">${notif.time}</p>
                    </div>
                `;
                item.onclick = () => markAsRead(notif.id);
                list.appendChild(item);
            });
        }

        function markAsRead(id) {
            const notif = notifications.find(n => n.id === id);
            if (notif) notif.unread = false;
            updateNotificationBadge();
            renderNotifications();
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => n.unread).length;
            document.getElementById('notificationBadge').textContent = unreadCount;
        }

        function dismissPWA() {
            document.getElementById('pwaBanner').classList.remove('active');
        }

        function installPWA() {
            dismissPWA();
            showToast('App installed successfully! 🎉', 'success');
            setTimeout(() => {
                showToast('You can now use BharatBazaar offline', 'info');
            }, 2000);
        }

        function syncONDC() {
            showToast('Syncing inventory to ONDC...', 'info');
            setTimeout(() => {
                showToast('✅ Inventory synced successfully! Your products are now live on ONDC network.', 'success');
            }, 2000);
        }

        function addProduct() {
            showToast('Add Product feature - Coming soon!', 'info');
        }

        function manageInventory() {
            showToast('Inventory management - Coming soon!', 'info');
        }

        function viewOrders() {
            showToast('Orders dashboard - Coming soon!', 'info');
        }

        function viewAnalytics() {
            showToast('Analytics dashboard - Coming soon!', 'info');
        }

        function placeOrder() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const loyaltyPoints = Math.round(total / 10);
            
            showToast('Processing your order...', 'info');
            setTimeout(() => {
                const orderId = 'ORD' + Math.floor(Math.random() * 100000);
                document.getElementById('trackingOrderId').textContent = orderId;
                
                if (deliveryMode === 'store') {
                    showToast(`✅ Order confirmed! Pickup code: ${orderId}. Ready in 15 mins. You'll earn ${loyaltyPoints * 2} loyalty points!`, 'success');
                } else {
                    showToast(`✅ Order placed! Delivery in 45 mins. You'll earn ${loyaltyPoints} loyalty points!`, 'success');
                }
                
                cart = [];
                updateCartBadge();
                showOrderTracking();
            }, 1500);
        }

        function showOrderTracking() {
            showSection('orderTracking');
            renderOrderTimeline();
            renderTrackingItems();
        }

        function renderOrderTimeline() {
            const timeline = document.getElementById('orderTimeline');
            const isStorePickup = deliveryMode === 'store';
            
            const stages = isStorePickup ? [
                { label: 'Order Placed', icon: '✅', status: 'completed', time: 'Just now' },
                { label: 'Order Confirmed', icon: '📦', status: 'completed', time: '2 mins ago' },
                { label: 'Preparing Order', icon: '👨‍🍳', status: 'active', time: 'In progress' },
                { label: 'Ready for Pickup', icon: '🏪', status: 'pending', time: '~13 mins' },
                { label: 'Picked Up', icon: '🎉', status: 'pending', time: 'Pending' }
            ] : [
                { label: 'Order Placed', icon: '✅', status: 'completed', time: 'Just now' },
                { label: 'Order Confirmed', icon: '📦', status: 'completed', time: '2 mins ago' },
                { label: 'Preparing Order', icon: '👨‍🍳', status: 'active', time: 'In progress' },
                { label: 'Out for Delivery', icon: '🛍️', status: 'pending', time: '~35 mins' },
                { label: 'Delivered', icon: '🎉', status: 'pending', time: 'Pending' }
            ];

            let html = '<div style="position: relative;">';
            stages.forEach((stage, index) => {
                const isLast = index === stages.length - 1;
                html += `
                    <div style="display: flex; gap: 1rem; margin-bottom: ${isLast ? '0' : '2rem'}; position: relative;">
                        <div style="min-width: 50px; text-align: center;">
                            <div style="width: 50px; height: 50px; border-radius: 50%; background: ${stage.status === 'completed' ? 'var(--secondary)' : stage.status === 'active' ? 'var(--primary)' : '#E0E0E0'}; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; position: relative; z-index: 1;">
                                ${stage.icon}
                            </div>
                            ${!isLast ? `<div style="width: 2px; height: 40px; background: ${stage.status === 'completed' ? 'var(--secondary)' : '#E0E0E0'}; margin: 0 auto;"></div>` : ''}
                        </div>
                        <div style="flex: 1; padding-top: 0.5rem;">
                            <strong style="color: ${stage.status === 'pending' ? 'var(--text-light)' : 'var(--text-dark)'}">${stage.label}</strong>
                            <p style="margin: 0.25rem 0 0 0; color: var(--text-light); font-size: 0.9rem;">${stage.time}</p>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            timeline.innerHTML = html;
            
            // Add real-time update notification
            if (isStorePickup) {
                html += `
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1)); padding: 1.5rem; border-radius: var(--radius); margin-top: 2rem; border: 2px solid var(--secondary);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 3rem;">🏪</div>
                            <div>
                                <h4 style="margin: 0 0 0.5rem 0; color: var(--secondary);">Store Pickup Details</h4>
                                <p style="margin: 0; color: var(--text-light);">Your order will be ready for pickup in approximately 15 minutes</p>
                            </div>
                        </div>
                        <div style="background: white; padding: 1rem; border-radius: var(--radius-sm);">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">Pickup Code: ${document.getElementById('trackingOrderId').textContent}</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">Show this code at the store counter</div>
                        </div>
                    </div>
                `;
                timeline.innerHTML = html;
            }
        }

        function renderTrackingItems() {
            const container = document.getElementById('trackingItems');
            let html = '';
            cart.slice(0, 3).forEach(item => {
                html += `
                    <div style="display: flex; gap: 1rem; align-items: center; padding: 1rem; background: var(--background); border-radius: var(--radius-sm); margin-bottom: 1rem;">
                        <div style="font-size: 2rem;">${item.icon}</div>
                        <div style="flex: 1;">
                            <strong>${item.name}</strong>
                            <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Qty: ${item.quantity}</p>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html || '<p style="text-align: center; color: var(--text-light);">No items</p>';
        }

        // Flash timer countdown
        function startFlashTimer() {
            const timerElement = document.getElementById('flashTimer');
            if (!timerElement) return;
            
            let hours = 5, minutes = 24, seconds = 18;
            
            setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                }
                if (minutes < 0) {
                    minutes = 59;
                    hours--;
                }
                if (hours < 0) {
                    hours = 0;
                    minutes = 0;
                    seconds = 0;
                }
                
                timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Simulate real-time activity
        function showLiveActivity() {
            const activities = [
                '🛍️ Rahul just ordered from Sharma Store',
                '⭐ Priya rated Kumar Electronics 5 stars',
                '🎉 3 new stores joined near you',
                '💰 Save ₹150 on groceries today!',
                '🚚 Fast delivery in your area'
            ];
            
            let index = 0;
            setInterval(() => {
                showToast(activities[index], 'info');
                index = (index + 1) % activities.length;
            }, 15000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            renderSellers();
            renderProducts();
            renderShopTypes();
            animateImpactNumbers();
            addQuickFilters();
            loadingAnimation();
            updateCartBadge();
            updateNotificationBadge();
            startFlashTimer();
            
            // Show live activity after 10 seconds
            setTimeout(showLiveActivity, 10000);
            
            // Show PWA banner after 5 seconds
            setTimeout(() => {
                document.getElementById('pwaBanner').classList.add('active');
            }, 5000);
            
            // Add floating animation to hero title
            const heroTitle = document.getElementById('heroTitle');
            if (heroTitle) {
                heroTitle.style.animation = 'float 3s ease-in-out infinite';
            }

            // Form submission
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitRegistration();
            });
        });

        // Map initialization
        function initMap() {
            map = L.map('map').setView([userLocation.lat, userLocation.lng], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // User location marker
            L.marker([userLocation.lat, userLocation.lng], {
                icon: L.divIcon({
                    className: 'user-marker',
                    html: '<div style="background: #000080; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">📍</div>',
                    iconSize: [20, 20]
                })
            }).addTo(map).bindPopup('You are here');

            markers = L.markerClusterGroup();
            addMarkersToMap();
        }

        function addMarkersToMap() {
            markers.clearLayers();
            
            sellers.forEach(seller => {
                const icon = shopTypes.find(t => t.type === seller.type)?.icon || '🏪';
                const marker = L.marker([seller.lat, seller.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="font-size: 24px;">${icon}</div>`,
                        iconSize: [30, 30]
                    })
                });

                const popupContent = `
                    <div style="padding: 10px;">
                        <h3 style="margin-bottom: 8px;">${seller.name}</h3>
                        <p style="margin: 4px 0;"><strong>${translations.phone[currentLanguage]}:</strong> ${seller.phone}</p>
                        <p style="margin: 4px 0;"><strong>${translations.distance[currentLanguage]}:</strong> ${seller.distance} ${translations.distance[currentLanguage]}</p>
                        <p style="margin: 4px 0;">⭐ ${seller.rating}</p>
                        <button onclick="openStoreDetail(${seller.id})" style="margin-top: 8px; padding: 8px 16px; background: #6366F1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🏪 View Store
                        </button>
                    </div>
                `;

                marker.bindPopup(popupContent);
                markers.addLayer(marker);
            });

            map.addLayer(markers);
        }

        // Render sellers
        function renderSellers() {
            const grid = document.getElementById('sellersGrid');
            grid.innerHTML = '';

            sellers.forEach(seller => {
                const icon = shopTypes.find(t => t.type === seller.type)?.icon || '🏪';
                const card = document.createElement('div');
                card.className = 'seller-card glass animate-in';
                card.style.animationDelay = `${sellers.indexOf(seller) * 0.05}s`;
                const isFeatured = seller.id <= 5;
                const sellerProducts = products.filter(p => p.sellerId === seller.id);
                const avgPrice = sellerProducts.length > 0 ? Math.round(sellerProducts.reduce((sum, p) => sum + p.price, 0) / sellerProducts.length) : 0;
                card.innerHTML = `
                    <div class="seller-header">
                        <div class="seller-type">${icon}</div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: end;">
                            ${seller.verified ? '<span class="verified-badge">✓ Verified</span>' : ''}
                            ${isFeatured ? '<span class="featured-badge">✨ Featured</span>' : ''}
                        </div>
                    </div>
                    <div class="seller-name">${seller.name}</div>
                    <div class="seller-info">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span>📍 ${seller.distance} km away</span>
                            <span style="color: var(--secondary); font-weight: 600;">• Open</span>
                        </div>
                        <div class="rating" style="margin-bottom: 0.5rem;">⭐ ${seller.rating} (${Math.floor(Math.random() * 200) + 50} reviews)</div>
                        <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 0.75rem; border-radius: var(--radius-sm); margin: 0.75rem 0;">
                            <div style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.25rem;">${sellerProducts.length} products available</div>
                            <div style="font-weight: bold; color: var(--primary); font-size: 1.1rem;">Avg ₹${avgPrice}</div>
                            <div style="font-size: 0.85rem; color: var(--secondary); font-weight: 600; margin-top: 0.25rem;">🏪 Visit & save 5% extra!</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
                            <button class="btn-primary" onclick="openStoreDetail(${seller.id}); event.stopPropagation();" style="flex: 1; padding: 0.6rem; font-size: 0.9rem;">
                                🏪 View Store
                            </button>
                            <button class="btn-secondary" onclick="openRouteNavigation(${seller.id}); event.stopPropagation();" style="padding: 0.6rem 1rem; font-size: 1.1rem;">
                                🗺️
                            </button>
                        </div>
                    </div>
                `;
                card.onclick = () => {
                    openStoreDetail(seller.id);
                };
                grid.appendChild(card);
            });
        }

        // Render products
        function addQuickFilters() {
            const container = document.querySelector('.products-header');
            if (!container || container.querySelector('.filter-chips')) return;
            
            const chipsHtml = `
                <div class="filter-chips">
                    <button class="filter-chip active" onclick="filterByCategory('all')">All</button>
                    <button class="filter-chip" onclick="filterByCategory('grocery')">🛒 Grocery</button>
                    <button class="filter-chip" onclick="filterByCategory('pharmacy')">💊 Pharmacy</button>
                    <button class="filter-chip" onclick="filterByCategory('electronics')">📱 Electronics</button>
                    <button class="filter-chip" onclick="filterByCategory('restaurant')">🍽️ Food</button>
                    <button class="filter-chip" onclick="filterByCategory('clothing')">👕 Fashion</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', chipsHtml);
        }

        function filterByCategory(category) {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            const filtered = category === 'all' ? products : products.filter(p => {
                const seller = sellers.find(s => s.id === p.sellerId);
                return seller && seller.type === category;
            });
            
            filtered.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card animate-in';
                card.style.animationDelay = `${index * 0.05}s`;
                const badges = ['', 'trending', 'new', '', ''];
                const badge = badges[Math.floor(Math.random() * badges.length)];
                const isInWishlist = wishlist.some(w => w.id === product.id);
                const isInCompare = compareList.some(c => c.id === product.id);
                card.innerHTML = `
                    ${badge ? `<div class="product-badge ${badge}">${badge === 'trending' ? '🔥 Trending' : '✨ New'}</div>` : ''}
                    <div style="position: absolute; top: 10px; left: 10px; display: flex; gap: 0.5rem;">
                        <button onclick="toggleWishlistItem(${product.id}); event.stopPropagation();" style="background: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; box-shadow: var(--shadow-sm); transition: var(--transition);" title="Add to wishlist">
                            ${isInWishlist ? '❤️' : '🤍'}
                        </button>
                    </div>
                    <div class="product-icon" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.icon}</div>
                    <div class="product-name" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.name}</div>
                    <div class="product-seller" onclick="openSellerDetail(${product.sellerId})" style="cursor: pointer; color: var(--primary); text-decoration: underline;">${product.seller}</div>
                    <div class="star-rating">⭐⭐⭐⭐☆ <span style="color: var(--text-light); font-size: 0.85rem;">(${Math.floor(Math.random() * 200) + 20})</span></div>
                    <div class="product-price">₹${product.price}</div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <button class="btn-add-cart" onclick="addToCart(${product.id}); event.stopPropagation();" style="flex: 1;">
                            🛒 Add
                        </button>
                        <button onclick="toggleCompare(${product.id}); event.stopPropagation();" style="background: ${isInCompare ? 'var(--primary)' : 'var(--secondary)'}; color: ${isInCompare ? 'white' : 'var(--text-dark)'}; border: none; padding: 0.75rem; border-radius: var(--radius-sm); cursor: pointer; font-weight: 600;" title="Compare">
                            ⚖️
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // New interactive functions
        function openProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const seller = sellers.find(s => s.id === product.sellerId);
            const productReviews = reviews[productId] || [];
            const avgRating = productReviews.length > 0 ? (productReviews.reduce((sum, r) => sum + r.rating, 0) / productReviews.length).toFixed(1) : '4.5';
            
            const relatedProducts = products.filter(p => p.sellerId === product.sellerId && p.id !== product.id).slice(0, 3);
            
            const storePrice = Math.round(product.price * 0.95);
            const amazonPrice = Math.round(product.price * 1.22);
            const flipkartPrice = Math.round(product.price * 1.18);
            const totalSavings = amazonPrice - storePrice;
            
            document.getElementById('productModalBody').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div style="font-size: 8rem; text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05)); border-radius: var(--radius); position: relative;">
                            ${product.icon}
                            <div style="position: absolute; top: 15px; right: 15px; background: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: bold;">🔥 Hot Deal</div>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; justify-content: center;">
                            <button class="btn-secondary" onclick="toggleWishlistItem(${product.id})" style="display: flex; align-items: center; gap: 0.5rem;">
                                ${wishlist.some(w => w.id === product.id) ? '❤️ In Wishlist' : '🤍 Add to Wishlist'}
                            </button>
                            <button class="btn-secondary" onclick="shareProduct(${product.id})" style="display: flex; align-items: center; gap: 0.5rem;">
                                📤 Share
                            </button>
                        </div>
                    </div>
                    <div>
                        <h2 style="margin-bottom: 1rem;">${product.name}</h2>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div class="star-rating" style="font-size: 1.2rem;">⭐⭐⭐⭐☆</div>
                            <span style="color: var(--text-light);">${avgRating} (${productReviews.length || Math.floor(Math.random() * 100)} reviews)</span>
                        </div>
                        <!-- Price Comparison Card -->
                        <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1.5rem; border: 2px solid rgba(99, 102, 241, 0.2);">
                            <h4 style="margin-bottom: 1rem; color: var(--primary);">💰 Price Comparison</h4>
                            <div style="display: grid; gap: 0.75rem;">
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--radius-sm); border: 2px solid var(--secondary);">
                                    <div>
                                        <div style="font-weight: bold; color: var(--secondary);">🏪 ${product.seller}</div>
                                        <div style="font-size: 0.85rem; color: var(--text-light);">Visit store price</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">₹${storePrice}</div>
                                        <div style="font-size: 0.85rem; color: var(--secondary); font-weight: 600;">Best Price!</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: var(--radius-sm);">
                                    <div>
                                        <div style="font-weight: 600;">🛒 Online Delivery</div>
                                        <div style="font-size: 0.85rem; color: var(--text-light);">From this seller</div>
                                    </div>
                                    <div style="font-size: 1.25rem; font-weight: bold;">₹${product.price}</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: var(--radius-sm);">
                                    <div>
                                        <div style="font-weight: 600;">🛒 Amazon</div>
                                        <div style="font-size: 0.85rem; color: var(--text-light);">Market price</div>
                                    </div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--text-light); text-decoration: line-through;">₹${amazonPrice}</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: var(--radius-sm);">
                                    <div>
                                        <div style="font-weight: 600;">🛍️ Flipkart</div>
                                        <div style="font-size: 0.85rem; color: var(--text-light);">Market price</div>
                                    </div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--text-light); text-decoration: line-through;">₹${flipkartPrice}</div>
                                </div>
                            </div>
                            <div style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.15); border-radius: var(--radius-sm); border: 2px solid var(--accent);">
                                <div style="font-weight: bold; color: var(--accent); font-size: 1.1rem; margin-bottom: 0.25rem;">🎯 YOU SAVE ₹${totalSavings}</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">by visiting the store instead of buying online!</div>
                            </div>
                        </div>
                        <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); margin-bottom: 1.5rem;">
                            <strong>Seller:</strong> <span onclick="openSellerDetail(${product.sellerId})" style="color: var(--primary); cursor: pointer; text-decoration: underline;">${product.seller}</span><br>
                            <strong>Category:</strong> ${seller ? seller.type : 'General'}<br>
                            <strong>Availability:</strong> <span style="color: var(--secondary);">✓ In Stock</span>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <h4>Description</h4>
                            <p style="color: var(--text-light); line-height: 1.6;">High quality ${product.name} from ${product.seller}. Premium product with excellent customer reviews. Fast delivery available.</p>
                        </div>
                        <!-- Action Buttons -->
                        <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                            <button class="btn-primary" onclick="addToCart(${product.id}); showToast('✅ Added to cart!', 'success');" style="padding: 1rem; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                <span style="font-size: 1.3rem;">🛒</span>
                                <span>Add to Cart - Order Online</span>
                            </button>
                            <button class="btn-secondary" onclick="openRouteNavigation(${product.sellerId}); closeProductModal();" style="padding: 1rem; font-size: 1.1rem; background: var(--secondary); color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                <span style="font-size: 1.3rem;">🏃</span>
                                <span>Visit Store & Save ₹${totalSavings}</span>
                            </button>
                        </div>
                        
                        <!-- Store Visit Benefits -->
                        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1)); padding: 1.25rem; border-radius: var(--radius); border: 2px dashed var(--secondary);">
                            <h4 style="margin-bottom: 0.75rem; color: var(--secondary);">🎁 Store Visit Benefits</h4>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;">
                                <div>✅ Extra 5% discount at counter</div>
                                <div>✅ See, touch & feel before buying</div>
                                <div>✅ Instant pickup - no waiting</div>
                                <div>✅ Earn 2x loyalty points</div>
                                <div>✅ Support your local community</div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #E0E0E0;">
                            <button class="btn-secondary" onclick="openReviewModal(${product.id}, 'product')" style="width: 100%;">
                                ✍️ Write a Review
                            </button>
                        </div>
                    </div>
                </div>
                ${relatedProducts.length > 0 ? `
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #E0E0E0;">
                    <h3 style="margin-bottom: 1rem;">More from ${product.seller}</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        ${relatedProducts.map(p => `
                            <div onclick="openProductDetail(${p.id})" style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); cursor: pointer; text-align: center; transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 3rem;">${p.icon}</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">${p.name}</div>
                                <div style="color: var(--secondary); font-weight: bold;">₹${p.price}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                ${productReviews.length > 0 ? `
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #E0E0E0;">
                    <h3 style="margin-bottom: 1rem;">Customer Reviews</h3>
                    ${productReviews.slice(0, 3).map(r => `
                        <div style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${r.name}</strong>
                                <div class="star-rating">${'⭐'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</div>
                            </div>
                            <p style="color: var(--text-light);">${r.text}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
            document.getElementById('productModal').classList.add('active');
        }
        
        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }
        
        function openSellerDetail(sellerId) {
            const seller = sellers.find(s => s.id === sellerId);
            if (!seller) return;
            
            const sellerProducts = products.filter(p => p.sellerId === sellerId);
            const sellerReviews = reviews['seller_' + sellerId] || [];
            
            document.getElementById('sellerModalBody').innerHTML = `
                <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 2rem; border-radius: var(--radius); color: white; margin-bottom: 2rem;">
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div style="font-size: 5rem;">${shopTypes.find(t => t.type === seller.type)?.icon || '🏪'}</div>
                        <div style="flex: 1;">
                            <h2 style="margin-bottom: 0.5rem; color: white;">${seller.name}</h2>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                <div class="star-rating" style="font-size: 1.2rem;">⭐⭐⭐⭐${seller.rating >= 4.5 ? '⭐' : '☆'}</div>
                                <span>${seller.rating} (${Math.floor(Math.random() * 500) + 100} reviews)</span>
                            </div>
                            ${seller.verified ? '<div class="verified-badge" style="background: white; color: var(--secondary);">✓ Verified Seller</div>' : ''}
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                    <div>
                        <div style="margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">📍 Location & Contact</h3>
                            <div style="background: var(--background); padding: 1.5rem; border-radius: var(--radius-sm);">
                                <p style="margin-bottom: 0.5rem;"><strong>Address:</strong> ${seller.id}, Main Market, New Delhi</p>
                                <p style="margin-bottom: 0.5rem;"><strong>Phone:</strong> ${seller.phone}</p>
                                <p style="margin-bottom: 0.5rem;"><strong>Distance:</strong> ${seller.distance} km away</p>
                                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                    <a href="tel:${seller.phone}" class="btn-primary" style="flex: 1; text-align: center; text-decoration: none;">
                                        📞 Call Seller
                                    </a>
                                    <a href="https://www.google.com/maps/dir/?api=1&destination=${seller.lat},${seller.lng}" target="_blank" class="btn-secondary" style="flex: 1; text-align: center; text-decoration: none;">
                                        🗺️ Get Directions
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="margin-bottom: 1rem;">🛍️ Products (${sellerProducts.length})</h3>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                                ${sellerProducts.slice(0, 6).map(p => `
                                    <div onclick="openProductDetail(${p.id})" style="padding: 1rem; background: var(--background); border-radius: var(--radius-sm); cursor: pointer; text-align: center; transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                                        <div style="font-size: 3rem;">${p.icon}</div>
                                        <div style="font-weight: 600; margin: 0.5rem 0; font-size: 0.9rem;">${p.name}</div>
                                        <div style="color: var(--secondary); font-weight: bold;">₹${p.price}</div>
                                        <button onclick="addToCart(${p.id}); event.stopPropagation();" class="btn-add-cart" style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; font-size: 0.85rem;">Add</button>
                                    </div>
                                `).join('')}
                            </div>
                            ${sellerProducts.length > 6 ? `<button class="btn-secondary" style="width: 100%; margin-top: 1rem;">View All ${sellerProducts.length} Products</button>` : ''}
                        </div>
                    </div>
                    
                    <div>
                        <div style="background: var(--background); padding: 1.5rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 1rem;">📊 Store Info</h4>
                            <p style="margin-bottom: 0.5rem;"><strong>Type:</strong> ${shopTypes.find(t => t.type === seller.type)?.label_en}</p>
                            <p style="margin-bottom: 0.5rem;"><strong>Products:</strong> ${sellerProducts.length}</p>
                            <p style="margin-bottom: 0.5rem;"><strong>Rating:</strong> ${seller.rating} ⭐</p>
                            <p style="margin-bottom: 0.5rem;"><strong>Status:</strong> <span style="color: var(--secondary);">● Open</span></p>
                        </div>
                        
                        <button class="btn-secondary" onclick="openReviewModal(${sellerId}, 'seller')" style="width: 100%; margin-bottom: 1rem;">
                            ✍️ Write Review
                        </button>
                        
                        <button class="btn-secondary" onclick="followSeller(${sellerId})" style="width: 100%;">
                            ➕ Follow Store
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('sellerModal').classList.add('active');
        }
        
        function closeSellerModal() {
            document.getElementById('sellerModal').classList.remove('active');
        }
        
        function toggleWishlistItem(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const index = wishlist.findIndex(w => w.id === productId);
            if (index > -1) {
                wishlist.splice(index, 1);
                showToast('Removed from wishlist', 'info');
            } else {
                wishlist.push(product);
                showToast('❤️ Added to wishlist!', 'success');
            }
            
            updateWishlistBadge();
            filterByCategory('all'); // Refresh display
        }
        
        function updateWishlistBadge() {
            document.getElementById('wishlistBadge').textContent = wishlist.length;
        }
        
        function toggleWishlist() {
            const modal = document.getElementById('wishlistModal');
            const content = document.getElementById('wishlistContent');
            
            if (wishlist.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-light);">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">❤️</div>
                        <h3>Your wishlist is empty</h3>
                        <p>Start adding products you love!</p>
                        <button class="btn-primary" onclick="closeWishlist(); showSection('products');" style="margin-top: 1rem;">
                            Browse Products
                        </button>
                    </div>
                `;
            } else {
                let html = '<div style="display: grid; gap: 1rem;">';
                wishlist.forEach(item => {
                    html += `
                        <div style="display: flex; gap: 1rem; align-items: center; padding: 1rem; background: var(--background); border-radius: var(--radius-sm);">
                            <div style="font-size: 3rem; cursor: pointer;" onclick="openProductDetail(${item.id})">${item.icon}</div>
                            <div style="flex: 1; cursor: pointer;" onclick="openProductDetail(${item.id})">
                                <div style="font-weight: 600;">${item.name}</div>
                                <div style="color: var(--text-light); font-size: 0.9rem;">${item.seller}</div>
                                <div style="color: var(--secondary); font-weight: bold; margin-top: 0.25rem;">₹${item.price}</div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button class="btn-primary" onclick="addToCart(${item.id})" style="padding: 0.5rem 1rem; white-space: nowrap;">
                                    🛒 Add to Cart
                                </button>
                                <button class="btn-secondary" onclick="toggleWishlistItem(${item.id})" style="padding: 0.5rem 1rem;">
                                    ❌ Remove
                                </button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                html += `
                    <button class="btn-primary" onclick="addAllToCart()" style="width: 100%; margin-top: 1rem; padding: 1rem;">
                        🛒 Add All to Cart (${wishlist.length} items)
                    </button>
                `;
                content.innerHTML = html;
            }
            
            modal.classList.add('active');
        }
        
        function closeWishlist() {
            document.getElementById('wishlistModal').classList.remove('active');
        }
        
        function addAllToCart() {
            let added = 0;
            wishlist.forEach(item => {
                const existingItem = cart.find(c => c.id === item.id);
                if (!existingItem) {
                    cart.push({ ...item, quantity: 1 });
                    added++;
                }
            });
            updateCartBadge();
            showToast(`Added ${added} items to cart!`, 'success');
            closeWishlist();
        }
        
        function toggleCompare(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const index = compareList.findIndex(c => c.id === productId);
            if (index > -1) {
                compareList.splice(index, 1);
                showToast('Removed from comparison', 'info');
            } else {
                if (compareList.length >= 4) {
                    showToast('Maximum 4 products can be compared', 'error');
                    return;
                }
                compareList.push(product);
                showToast('Added to comparison!', 'success');
            }
            
            updateCompareButton();
            filterByCategory('all'); // Refresh
        }
        
        function updateCompareButton() {
            let btn = document.getElementById('compareFloatingBtn');
            if (!btn && compareList.length > 0) {
                btn = document.createElement('button');
                btn.id = 'compareFloatingBtn';
                btn.className = 'btn-primary';
                btn.style.cssText = 'position: fixed; bottom: 2rem; right: 2rem; z-index: 1500; padding: 1rem 1.5rem; box-shadow: var(--shadow-lg); border-radius: var(--radius-full);';
                btn.onclick = openCompareModal;
                document.body.appendChild(btn);
            }
            
            if (btn) {
                if (compareList.length > 0) {
                    btn.innerHTML = `⚖️ Compare (${compareList.length})`;
                    btn.style.display = 'block';
                } else {
                    btn.style.display = 'none';
                }
            }
        }
        
        function openCompareModal() {
            if (compareList.length === 0) return;
            
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--background);">
                                <th style="padding: 1rem; text-align: left; position: sticky; left: 0; background: var(--background);">Feature</th>
                                ${compareList.map(p => `<th style="padding: 1rem; text-align: center;">${p.name}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 1rem; font-weight: 600; border-top: 1px solid #E0E0E0; position: sticky; left: 0; background: white;">Product</td>
                                ${compareList.map(p => `<td style="padding: 1rem; text-align: center; border-top: 1px solid #E0E0E0;"><div style="font-size: 4rem;">${p.icon}</div></td>`).join('')}
                            </tr>
                            <tr>
                                <td style="padding: 1rem; font-weight: 600; border-top: 1px solid #E0E0E0; position: sticky; left: 0; background: white;">Price</td>
                                ${compareList.map(p => {
                                    const isLowest = p.price === Math.min(...compareList.map(cp => cp.price));
                                    return `<td style="padding: 1rem; text-align: center; border-top: 1px solid #E0E0E0; color: ${isLowest ? 'var(--secondary)' : 'inherit'}; font-weight: ${isLowest ? 'bold' : 'normal'};">₹${p.price} ${isLowest ? '✓' : ''}</td>`;
                                }).join('')}
                            </tr>
                            <tr>
                                <td style="padding: 1rem; font-weight: 600; border-top: 1px solid #E0E0E0; position: sticky; left: 0; background: white;">Seller</td>
                                ${compareList.map(p => `<td style="padding: 1rem; text-align: center; border-top: 1px solid #E0E0E0;">${p.seller}</td>`).join('')}
                            </tr>
                            <tr>
                                <td style="padding: 1rem; font-weight: 600; border-top: 1px solid #E0E0E0; position: sticky; left: 0; background: white;">Rating</td>
                                ${compareList.map(p => `<td style="padding: 1rem; text-align: center; border-top: 1px solid #E0E0E0;">⭐⭐⭐⭐☆</td>`).join('')}
                            </tr>
                            <tr>
                                <td style="padding: 1rem; font-weight: 600; border-top: 1px solid #E0E0E0; position: sticky; left: 0; background: white;">Action</td>
                                ${compareList.map(p => `
                                    <td style="padding: 1rem; text-align: center; border-top: 1px solid #E0E0E0;">
                                        <button class="btn-primary" onclick="addToCart(${p.id})" style="width: 100%; margin-bottom: 0.5rem;">Add to Cart</button>
                                        <button class="btn-secondary" onclick="toggleCompare(${p.id}); openCompareModal();" style="width: 100%;">Remove</button>
                                    </td>
                                `).join('')}
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                    <button class="btn-secondary" onclick="clearComparison()" style="flex: 1;">Clear All</button>
                    <button class="btn-primary" onclick="closeCompareModal()" style="flex: 1;">Close</button>
                </div>
            `;
            
            document.getElementById('compareModalBody').innerHTML = html;
            document.getElementById('compareModal').classList.add('active');
        }
        
        function closeCompareModal() {
            document.getElementById('compareModal').classList.remove('active');
        }
        
        function clearComparison() {
            compareList = [];
            updateCompareButton();
            closeCompareModal();
            showToast('Comparison cleared', 'info');
            filterByCategory('all');
        }
        
        function openAdvancedFilters() {
            document.getElementById('filtersModal').classList.add('active');
        }
        
        function closeAdvancedFilters() {
            document.getElementById('filtersModal').classList.remove('active');
        }
        
        function updatePriceDisplay() {
            const val = document.getElementById('priceMin').value;
            document.getElementById('priceMinDisplay').textContent = val;
        }
        
        let activeRatingFilter = 0;
        function setRatingFilter(rating, btn) {
            document.querySelectorAll('#filtersModal .filter-chip').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            activeRatingFilter = rating;
        }
        
        function applyAdvancedFilters() {
            const maxPrice = parseInt(document.getElementById('priceMin').value) || 60000;
            const openNow = document.getElementById('filterOpenNow').checked;
            const freeDelivery = document.getElementById('filterFreeDelivery').checked;
            
            const filtered = products.filter(p => {
                if (p.price > maxPrice) return false;
                return true;
            });
            
            // Re-render with filtered products
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            filtered.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card animate-in';
                card.style.animationDelay = `${index * 0.05}s`;
                const isInWishlist = wishlist.some(w => w.id === product.id);
                const isInCompare = compareList.some(c => c.id === product.id);
                card.innerHTML = `
                    <div style="position: absolute; top: 10px; left: 10px; display: flex; gap: 0.5rem;">
                        <button onclick="toggleWishlistItem(${product.id}); event.stopPropagation();" style="background: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; box-shadow: var(--shadow-sm);">
                            ${isInWishlist ? '❤️' : '🤍'}
                        </button>
                    </div>
                    <div class="product-icon" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.icon}</div>
                    <div class="product-name" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.name}</div>
                    <div class="product-seller" onclick="openSellerDetail(${product.sellerId})" style="cursor: pointer; color: var(--primary); text-decoration: underline;">${product.seller}</div>
                    <div class="star-rating">⭐⭐⭐⭐☆</div>
                    <div class="product-price">₹${product.price}</div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <button class="btn-add-cart" onclick="addToCart(${product.id}); event.stopPropagation();" style="flex: 1;">🛒 Add</button>
                        <button onclick="toggleCompare(${product.id}); event.stopPropagation();" style="background: ${isInCompare ? 'var(--primary)' : 'var(--secondary)'}; color: ${isInCompare ? 'white' : 'var(--text-dark)'}; border: none; padding: 0.75rem; border-radius: var(--radius-sm); cursor: pointer; font-weight: 600;">⚖️</button>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            showToast(`Found ${filtered.length} products`, 'success');
            closeAdvancedFilters();
        }
        
        function clearAllFilters() {
            document.getElementById('priceMin').value = 60000;
            document.getElementById('filterOpenNow').checked = false;
            document.getElementById('filterFreeDelivery').checked = false;
            activeRatingFilter = 0;
            updatePriceDisplay();
            applyAdvancedFilters();
        }
        
        function sortProducts(sortBy) {
            let sorted = [...products];
            
            switch(sortBy) {
                case 'price-low':
                    sorted.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    sorted.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    sorted.sort((a, b) => (b.rating || 4.5) - (a.rating || 4.5));
                    break;
                case 'discount':
                    sorted.sort((a, b) => (b.discount || 0) - (a.discount || 0));
                    break;
            }
            
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            sorted.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card animate-in';
                card.style.animationDelay = `${index * 0.05}s`;
                const isInWishlist = wishlist.some(w => w.id === product.id);
                const isInCompare = compareList.some(c => c.id === product.id);
                card.innerHTML = `
                    <div style="position: absolute; top: 10px; left: 10px;">
                        <button onclick="toggleWishlistItem(${product.id}); event.stopPropagation();" style="background: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; box-shadow: var(--shadow-sm);">
                            ${isInWishlist ? '❤️' : '🤍'}
                        </button>
                    </div>
                    <div class="product-icon" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.icon}</div>
                    <div class="product-name" onclick="openProductDetail(${product.id})" style="cursor: pointer;">${product.name}</div>
                    <div class="product-seller" onclick="openSellerDetail(${product.sellerId})" style="cursor: pointer; color: var(--primary); text-decoration: underline;">${product.seller}</div>
                    <div class="star-rating">⭐⭐⭐⭐☆</div>
                    <div class="product-price">₹${product.price}</div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <button class="btn-add-cart" onclick="addToCart(${product.id}); event.stopPropagation();" style="flex: 1;">🛒 Add</button>
                        <button onclick="toggleCompare(${product.id}); event.stopPropagation();" style="background: ${isInCompare ? 'var(--primary)' : 'var(--secondary)'}; color: ${isInCompare ? 'white' : 'var(--text-dark)'}; border: none; padding: 0.75rem; border-radius: var(--radius-sm); cursor: pointer; font-weight: 600;">⚖️</button>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            showToast(`Sorted by ${sortBy}`, 'info');
        }
        
        function filterProductsWithSuggestions() {
            filterProducts();
            const query = document.getElementById('searchProducts').value.toLowerCase();
            
            if (query.length >= 2) {
                const suggestions = [];
                
                // Add matching products
                products.forEach(p => {
                    if (p.name.toLowerCase().includes(query) || p.seller.toLowerCase().includes(query)) {
                        suggestions.push({ type: 'product', name: p.name, id: p.id });
                    }
                });
                
                // Add matching sellers
                sellers.forEach(s => {
                    if (s.name.toLowerCase().includes(query)) {
                        suggestions.push({ type: 'seller', name: s.name, id: s.id });
                    }
                });
                
                if (suggestions.length > 0) {
                    showSearchSuggestionsDropdown(suggestions.slice(0, 8));
                } else {
                    hideSearchSuggestions();
                }
            } else {
                hideSearchSuggestions();
            }
        }
        
        function showSearchSuggestions() {
            const container = document.getElementById('searchSuggestions');
            const popular = ['Rice', 'Medicine', 'Mobile', 'Shirt', 'Biryani'];
            
            let html = '<div style="padding: 1rem;">';
            html += '<div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-light); font-size: 0.85rem;">POPULAR SEARCHES</div>';
            popular.forEach(term => {
                html += `<div onclick="searchFromSuggestion('${term}')" style="padding: 0.75rem; cursor: pointer; border-radius: var(--radius-sm); transition: var(--transition);" onmouseover="this.style.background='var(--background)'" onmouseout="this.style.background='transparent'">
                    🔍 ${term}
                </div>`;
            });
            html += '</div>';
            
            container.innerHTML = html;
            container.style.display = 'block';
        }
        
        function showSearchSuggestionsDropdown(suggestions) {
            const container = document.getElementById('searchSuggestions');
            let html = '<div style="padding: 0.5rem;">';
            
            suggestions.forEach(s => {
                const icon = s.type === 'product' ? '📦' : '🏪';
                html += `<div onclick="${s.type === 'product' ? 'openProductDetail(' + s.id + ')' : 'openSellerDetail(' + s.id + ')'}; hideSearchSuggestions();" style="padding: 0.75rem; cursor: pointer; border-radius: var(--radius-sm); display: flex; align-items: center; gap: 0.5rem; transition: var(--transition);" onmouseover="this.style.background='var(--background)'" onmouseout="this.style.background='transparent'">
                    <span>${icon}</span>
                    <span style="flex: 1;">${s.name}</span>
                    <span style="font-size: 0.8rem; color: var(--text-light);">${s.type}</span>
                </div>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
            container.style.display = 'block';
        }
        
        function hideSearchSuggestions() {
            document.getElementById('searchSuggestions').style.display = 'none';
        }
        
        function searchFromSuggestion(term) {
            document.getElementById('searchProducts').value = term;
            filterProducts();
            hideSearchSuggestions();
        }
        
        function openReviewModal(itemId, type) {
            document.getElementById('reviewItemId').value = itemId;
            document.getElementById('reviewItemId').setAttribute('data-type', type);
            document.getElementById('reviewModal').classList.add('active');
            setRating(5);
        }
        
        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('active');
        }
        
        function setRating(rating) {
            document.getElementById('reviewRating').value = rating;
            const stars = document.querySelectorAll('#ratingStars span');
            stars.forEach((star, index) => {
                star.style.color = index < rating ? '#FFD700' : '#ddd';
            });
        }
        
        function submitReview() {
            const itemId = document.getElementById('reviewItemId').value;
            const type = document.getElementById('reviewItemId').getAttribute('data-type');
            const rating = parseInt(document.getElementById('reviewRating').value);
            const text = document.getElementById('reviewText').value;
            
            if (!text.trim()) {
                showToast('Please write a review', 'error');
                return;
            }
            
            const key = type === 'seller' ? 'seller_' + itemId : itemId;
            if (!reviews[key]) reviews[key] = [];
            
            reviews[key].push({
                rating,
                text,
                name: 'Customer',
                date: new Date().toLocaleDateString()
            });
            
            showToast('✅ Review submitted successfully!', 'success');
            closeReviewModal();
            document.getElementById('reviewText').value = '';
        }
        
        function shareProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (navigator.share) {
                navigator.share({
                    title: product.name,
                    text: `Check out ${product.name} on BharatBazaar!`,
                    url: window.location.href
                });
            } else {
                showToast('Link copied to clipboard!', 'success');
            }
        }
        
        function followSeller(sellerId) {
            showToast('✓ Following seller! You\'ll get updates on new products.', 'success');
        }
        
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card animate-in';
                card.style.animationDelay = `${products.indexOf(product) * 0.05}s`;
                card.style.cursor = 'pointer';
                const badges = ['', 'trending', 'new', '', ''];
                const badge = badges[Math.floor(Math.random() * badges.length)];
                const isInWishlist = wishlist.some(w => w.id === product.id);
                card.innerHTML = `
                    ${badge ? `<div class="product-badge ${badge}">${badge === 'trending' ? '🔥 Trending' : '✨ New'}</div>` : ''}
                    <div style="position: absolute; top: 10px; left: 10px;">
                        <button onclick="toggleWishlistItem(${product.id}); event.stopPropagation();" style="background: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; box-shadow: var(--shadow-sm); transition: var(--transition);">
                            ${isInWishlist ? '❤️' : '🤍'}
                        </button>
                    </div>
                    <div class="product-icon" onclick="openProductDetail(${product.id})">${product.icon}</div>
                    <div class="product-name" onclick="openProductDetail(${product.id})">${product.name}</div>
                    <div class="product-seller" onclick="openSellerDetail(${product.sellerId}); event.stopPropagation();" style="cursor: pointer; color: var(--primary); text-decoration: underline;">${product.seller}</div>
                    <div class="star-rating">⭐⭐⭐⭐☆ <span style="color: var(--text-light); font-size: 0.85rem;">(${Math.floor(Math.random() * 200) + 20})</span></div>
                    <div class="product-price">₹${product.price}</div>
                    <button class="btn-add-cart" onclick="addToCart(${product.id}); event.stopPropagation();">
                        🛒 Add to Cart
                    </button>
                `;
                card.onclick = () => openProductDetail(product.id);
                grid.appendChild(card);
            });
        }

        // Filter products
        function filterProducts() {
            const query = document.getElementById('searchProducts').value.toLowerCase();
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.seller.toLowerCase().includes(query)
            );

            filtered.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-icon">${product.icon}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-seller">${product.seller}</div>
                    <div class="product-price">₹${product.price}</div>
                    <button class="btn-add-cart" onclick="addToCart(${product.id})">
                        ${translations.addToCart[currentLanguage]}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        // Filter sellers
        function searchLocation() {
            // Real-time search simulation
            const query = document.getElementById('searchLocation').value.toLowerCase();
            if (query.length > 2) {
                // Could filter sellers by location here
                console.log('Searching for:', query);
            }
        }

        function filterSellers() {
            const radiusFilter = document.getElementById('radiusFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            
            // This is a simplified filter - in a real app you'd recalculate distances
            renderSellers();
        }

        // View seller products
        function viewSellerProducts(sellerId) {
            openStoreDetail(sellerId);
        }

        function openStoreDetail(sellerId) {
            const seller = sellers.find(s => s.id === sellerId);
            if (!seller) return;
            
            const sellerProducts = products.filter(p => p.sellerId === sellerId);
            const icon = shopTypes.find(t => t.type === seller.type)?.icon || '🏪';
            
            document.getElementById('storeDetailBody').innerHTML = `
                <!-- Store Header -->
                <div style="background: linear-gradient(135deg, var(--primary), #8B5CF6); padding: 2rem; border-radius: var(--radius); color: white; margin-bottom: 2rem;">
                    <div style="display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;">
                        <div style="font-size: 5rem; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: var(--radius); backdrop-filter: blur(10px);">${icon}</div>
                        <div style="flex: 1; min-width: 300px;">
                            <h2 style="margin-bottom: 0.5rem; color: white; font-size: 2rem;">${seller.name}</h2>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 0.25rem;">⭐ ${seller.rating} <span style="opacity: 0.9;">(${Math.floor(Math.random() * 500) + 100} reviews)</span></div>
                                <div style="opacity: 0.9;">📍 ${seller.distance} km away</div>
                                <div style="opacity: 0.9;">🕐 Open until 10 PM</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                ${seller.verified ? '<span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">✓ Verified</span>' : ''}
                                <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">🌐 ONDC</span>
                                <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">🚚 Fast Delivery</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 2rem; background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: var(--radius); backdrop-filter: blur(10px);">
                        <div style="text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">45 min</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Delivery Time</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">5%</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Visit Discount</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">Rs.20</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Delivery Fee</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">Free</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Orders over Rs.299</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <a href="tel:${seller.phone}" class="btn-primary" style="flex: 1; text-align: center; text-decoration: none; min-width: 150px; background: white; color: var(--primary); font-weight: 600;">📞 Call Store</a>
                        <button class="btn-primary" onclick="openRouteNavigation(${seller.id})" style="flex: 1; min-width: 150px; background: white; color: var(--primary); font-weight: 600;">🗺️ Get Directions</button>
                        <button class="btn-primary" onclick="followSeller(${seller.id})" style="flex: 1; min-width: 150px; background: rgba(255,255,255,0.3); border: 2px solid white; font-weight: 600;">❤️ Follow Store</button>
                    </div>
                </div>
                
                <!-- Product Grid -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.5rem; margin: 0;">🛍️ Products (${sellerProducts.length})</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="filter-chip active" onclick="filterStoreCategory('all', ${seller.id})">All</button>
                            <button class="filter-chip" onclick="filterStoreCategory('hot', ${seller.id})">🔥 Hot Deals</button>
                            <button class="filter-chip" onclick="filterStoreCategory('new', ${seller.id})">✨ New</button>
                        </div>
                    </div>
                    
                    <div id="storeProductGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                        ${sellerProducts.map(product => {
                            const mrp = Math.round(product.price * 1.25);
                            const discount = Math.round(((mrp - product.price) / mrp) * 100);
                            const storePrice = Math.round(product.price * 0.95);
                            const amazonPrice = Math.round(product.price * 1.22);
                            const savings = amazonPrice - storePrice;
                            
                            return `
                                <div class="glass" style="padding: 1rem; border-radius: var(--radius); transition: var(--transition); cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);" onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 20px rgba(99, 102, 241, 0.25)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(99, 102, 241, 0.1)';" onclick="openProductDetail(${product.id})">
                                    ${discount > 0 ? `<div style="position: absolute; top: 10px; right: 10px; background: var(--accent); color: white; padding: 0.25rem 0.5rem; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: bold; z-index: 1;">${discount}% OFF</div>` : ''}
                                    <div style="font-size: 4rem; text-align: center; margin-bottom: 0.75rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">${product.icon}</div>
                                    <h4 style="font-size: 0.95rem; margin-bottom: 0.5rem; height: 2.4em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${product.name}</h4>
                                    
                                    <!-- Price Comparison -->
                                    <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 0.75rem; border-radius: var(--radius-sm); margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.25rem;">
                                            <span style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">₹${product.price}</span>
                                            <span style="text-decoration: line-through; color: var(--text-light); font-size: 0.9rem;">₹${mrp}</span>
                                        </div>
                                        <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.5rem;">🛒 Online: ₹${amazonPrice}</div>
                                        <div style="background: rgba(16, 185, 129, 0.15); padding: 0.4rem 0.6rem; border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: 600; color: var(--secondary); border: 1px solid rgba(16, 185, 129, 0.3);">
                                            🏪 Visit & save ₹${savings}!
                                        </div>
                                    </div>
                                    
                                    <div style="display: flex; align-items: center; gap: 0.25rem; margin-bottom: 0.75rem; font-size: 0.85rem;">
                                        <span style="color: #FFD700;">⭐⭐⭐⭐☆</span>
                                        <span style="color: var(--text-light);">(${Math.floor(Math.random() * 100) + 20})</span>
                                    </div>
                                    
                                    <div style="font-size: 0.85rem; color: var(--secondary); font-weight: 600; margin-bottom: 0.75rem;">✅ In Stock</div>
                                    
                                    <button class="btn-primary" onclick="addToCart(${product.id}); event.stopPropagation();" style="width: 100%; padding: 0.75rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                        <span>🛒</span> Add to Cart
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <!-- Delivery Options -->
                <div class="glass" style="padding: 2rem; border-radius: var(--radius); background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));">
                    <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem;">📦 Delivery Options</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div style="background: white; padding: 1.5rem; border-radius: var(--radius); border: 2px solid var(--primary); position: relative;">
                            <div style="position: absolute; top: -12px; right: 20px; background: var(--accent); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;">RECOMMENDED</div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="font-size: 3rem;">🏃</div>
                                <div>
                                    <h4 style="margin: 0 0 0.25rem 0;">Visit Store & Save</h4>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Pick up from store</p>
                                </div>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">
                                <div style="font-weight: bold; color: var(--secondary); margin-bottom: 0.5rem;">💰 Extra 5% OFF at store</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">Ready in 15 mins</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">📍 ${seller.distance} km • 12 min walk</div>
                            </div>
                            <button class="btn-primary" onclick="openRouteNavigation(${seller.id})" style="width: 100%;">
                                🗺️ Get Directions
                            </button>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: var(--radius); border: 2px solid #E5E7EB;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="font-size: 3rem;">🚚</div>
                                <div>
                                    <h4 style="margin: 0 0 0.25rem 0;">Deliver to Me</h4>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Doorstep delivery</p>
                                </div>
                            </div>
                            <div style="background: rgba(99, 102, 241, 0.1); padding: 1rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">
                                <div style="font-weight: bold; color: var(--primary); margin-bottom: 0.5rem;">⚡ Fast & Convenient</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">Delivery in 45 mins</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">💳 Pay online or COD</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">Delivery fee: Rs.20 (Free over Rs.299)</div>
                            </div>
                            <button class="btn-secondary" onclick="showToast('Add items to cart to order online', 'info')" style="width: 100%;">
                                🛒 Order Online
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('storeDetailModal').classList.add('active');
        }
        
        function closeStoreDetail() {
            document.getElementById('storeDetailModal').classList.remove('active');
        }
        
        function filterStoreCategory(category, sellerId) {
            // Update active chip
            document.querySelectorAll('#storeDetailModal .filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter would happen here
            showToast(`Showing ${category} products`, 'info');
        }
        
        function openRouteNavigation(sellerId) {
            const seller = sellers.find(s => s.id === sellerId);
            if (!seller) return;
            
            const walkTime = Math.round(seller.distance * 12);
            const bikeTime = Math.round(seller.distance * 5);
            const carTime = Math.round(seller.distance * 3);
            
            document.getElementById('routeModalBody').innerHTML = `
                <div style="background: linear-gradient(135deg, var(--primary), #8B5CF6); padding: 1.5rem; border-radius: var(--radius); color: white; margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 0.5rem; color: white;">Your Location → ${seller.name}</h3>
                    <div style="font-size: 1.25rem; font-weight: bold;">📍 Distance: ${seller.distance} km</div>
                </div>
                
                <!-- Map Placeholder -->
                <div style="background: #E5E7EB; height: 300px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; margin-bottom: 2rem; position: relative; overflow: hidden;">
                    <div style="text-align: center; z-index: 1;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">🗺️</div>
                        <p style="color: var(--text-light); font-size: 1.1rem;">Interactive map with route</p>
                    </div>
                    <div style="position: absolute; top: 20px; left: 20px; background: white; padding: 0.75rem 1rem; border-radius: var(--radius-sm); box-shadow: var(--shadow-md); font-weight: 600;">
                        📍 You
                    </div>
                    <div style="position: absolute; bottom: 20px; right: 20px; background: var(--primary); color: white; padding: 0.75rem 1rem; border-radius: var(--radius-sm); box-shadow: var(--shadow-md); font-weight: 600;">
                        🏪 ${seller.name}
                    </div>
                </div>
                
                <!-- Transport Options -->
                <h3 style="margin-bottom: 1rem;">🚶 Choose Your Mode</h3>
                <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                    <div class="glass" style="padding: 1.25rem; border-radius: var(--radius); display: flex; align-items: center; gap: 1.5rem; transition: var(--transition); cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='transparent'">
                        <div style="font-size: 3rem;">🚶</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.25rem;">Walking</div>
                            <div style="color: var(--text-light);">Most eco-friendly option</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">${walkTime} min</div>
                            <div style="font-size: 0.85rem; color: var(--text-light);">${seller.distance} km</div>
                        </div>
                    </div>
                    
                    <div class="glass" style="padding: 1.25rem; border-radius: var(--radius); display: flex; align-items: center; gap: 1.5rem; transition: var(--transition); cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='transparent'">
                        <div style="font-size: 3rem;">🚴</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.25rem;">Cycling</div>
                            <div style="color: var(--text-light);">Quick and healthy</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">${bikeTime} min</div>
                            <div style="font-size: 0.85rem; color: var(--text-light);">${seller.distance} km</div>
                        </div>
                    </div>
                    
                    <div class="glass" style="padding: 1.25rem; border-radius: var(--radius); display: flex; align-items: center; gap: 1.5rem; transition: var(--transition); cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='transparent'">
                        <div style="font-size: 3rem;">🚗</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.25rem;">Driving</div>
                            <div style="color: var(--text-light);">Fastest option</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent);">${carTime} min</div>
                            <div style="font-size: 0.85rem; color: var(--text-light);">${seller.distance} km</div>
                        </div>
                    </div>
                </div>
                
                <!-- Route Options -->
                <h3 style="margin-bottom: 1rem;">🛣️ Route Options</h3>
                <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                    <div class="glass" style="padding: 1rem; border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Via Main Road</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">Fastest route • Less traffic</div>
                        </div>
                        <div style="background: var(--secondary); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: bold;">Recommended</div>
                    </div>
                    <div class="glass" style="padding: 1rem; border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Via Park Street</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">Scenic route • +5 min</div>
                        </div>
                    </div>
                </div>
                
                <!-- Store Info -->
                <div class="glass" style="padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem; background: rgba(16, 185, 129, 0.05);">
                    <h4 style="margin-bottom: 1rem;">📋 Store Information</h4>
                    <div style="display: grid; gap: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.25rem;">🅿️</span>
                            <span>Parking Available</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.25rem;">⏰</span>
                            <span>Open: 8 AM - 10 PM</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.25rem;">📞</span>
                            <span>${seller.phone}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <a href="https://www.google.com/maps/dir/?api=1&destination=${seller.lat},${seller.lng}" target="_blank" class="btn-primary" style="text-decoration: none; text-align: center; padding: 1rem; font-size: 1.1rem;">
                        🗺️ Open in Google Maps
                    </a>
                    <a href="tel:${seller.phone}" class="btn-secondary" style="text-decoration: none; text-align: center; padding: 1rem; font-size: 1.1rem;">
                        📞 Call Store
                    </a>
                </div>
            `;
            
            document.getElementById('routeModal').classList.add('active');
        }
        
        function closeRouteModal() {
            document.getElementById('routeModal').classList.remove('active');
        }

        // Render shop types
        function renderShopTypes() {
            const grid = document.getElementById('shopTypesGrid');
            grid.innerHTML = '';

            shopTypes.forEach(type => {
                const card = document.createElement('div');
                card.className = 'shop-type-card';
                card.innerHTML = `
                    <div class="icon">${type.icon}</div>
                    <div>${type[`label_${currentLanguage}`]}</div>
                `;
                card.onclick = () => selectShopType(type.type, card);
                grid.appendChild(card);
            });
        }

        function selectShopType(type, element) {
            document.querySelectorAll('.shop-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('shopType').value = type;
        }

        // Cart functions
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity++;
                showToast(`Updated ${product.name} quantity!`, 'success');
            } else {
                cart.push({ ...product, quantity: 1 });
                showToast(`${product.name} added to cart! 🛒`, 'success');
                
                // Show profile link after first add to cart
                document.getElementById('btnMyProfile').style.display = 'block';
            }

            updateCartBadge();
            
            // Add pulse animation to cart icon
            const cartIcon = document.querySelector('.cart-icon');
            if (cartIcon) {
                cartIcon.style.animation = 'pulse 0.5s ease';
                setTimeout(() => {
                    cartIcon.style.animation = '';
                }, 500);
            }
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            badge.textContent = totalItems;
        }

        function openCart() {
            const modal = document.getElementById('cartModal');
            const content = document.getElementById('cartContent');

            if (cart.length === 0) {
                content.innerHTML = `<div class="empty-cart">${translations.emptyCart[currentLanguage]}</div>`;
            } else {
                let cartHTML = '<div class="cart-items">';
                
                cart.forEach(item => {
                    cartHTML += `
                        <div class="cart-item">
                            <div class="cart-item-icon">${item.icon}</div>
                            <div class="cart-item-details">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">₹${item.price}</div>
                            </div>
                            <div class="quantity-controls">
                                <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            </div>
                        </div>
                    `;
                });

                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const onlineFee = 20;
                const total = subtotal + onlineFee;
                cartHTML += '</div>';
                cartHTML += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 1.1rem;">
                        <span>Subtotal:</span>
                        <span>₹${subtotal}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 1.1rem; color: var(--accent);">
                        <span>Online Ordering Fee:</span>
                        <span>₹${onlineFee}</span>
                    </div>
                    <div class="cart-total">
                        <span>Total:</span>
                        <span>₹${total}</span>
                    </div>
                    <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="checkout()">
                        ${translations.checkout[currentLanguage]}
                    </button>
                `;

                content.innerHTML = cartHTML;
            }

            modal.classList.add('active');
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }

        function updateQuantity(productId, change) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== productId);
                }
                updateCartBadge();
                openCart();
            }
        }

        function checkout() {
            closeCart();
            showSection('checkout');
            renderCheckoutSummary();
        }
        
        let deliveryMode = 'online';
        
        function setDeliveryMode(mode) {
            deliveryMode = mode;
            document.querySelectorAll('.delivery-mode-card').forEach(card => {
                card.style.borderColor = '#E5E7EB';
            });
            event.target.closest('.delivery-mode-card').style.borderColor = 'var(--primary)';
            renderCheckoutSummary();
        }

        function applyCoupon() {
            const codes = ['FIRST10', 'SAVE20', 'LOCAL15'];
            const code = prompt('Enter coupon code:');
            if (code && codes.includes(code.toUpperCase())) {
                showToast(`✅ Coupon ${code} applied! You saved ₹50`, 'success');
            } else if (code) {
                showToast('❌ Invalid coupon code', 'error');
            }
        }

        function renderCheckoutSummary() {
            const summary = document.getElementById('checkoutSummary');
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const delivery = deliveryMode === 'online' ? 30 : 0;
            const storeDiscount = deliveryMode === 'store' ? Math.round(subtotal * 0.05) : 0;
            const total = subtotal + delivery - storeDiscount;
            
            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            cart.forEach(item => {
                const storePrice = Math.round(item.price * 0.95);
                html += `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--background); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                        <div>
                            <div style="font-weight: 600;">${item.name} x${item.quantity}</div>
                            <div style="font-size: 0.85rem; color: var(--text-light);">Online: ₹${item.price * item.quantity} | Store: ₹${storePrice * item.quantity}</div>
                        </div>
                        <span style="font-weight: bold;">₹${item.price * item.quantity}</span>
                    </div>
                `;
            });
            const storeSavings = Math.round(subtotal * 0.05);
            const storeTotal = subtotal - storeSavings;
            html += `
                <div style="border-top: 1px solid #E0E0E0; margin-top: 0.5rem; padding-top: 0.75rem;"></div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Subtotal</span>
                    <span>₹${subtotal}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Delivery</span>
                    <span>₹${delivery}</span>
                </div>
                <div style="border-top: 2px solid var(--primary); margin-top: 0.5rem; padding-top: 0.75rem; display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold;">
                    <span>Total (Online)</span>
                    <span style="color: var(--primary);">₹${total}</span>
                </div>
                <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1)); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem; border: 2px solid var(--secondary);">
                    <div style="font-weight: bold; color: var(--secondary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">🏪</span>
                        <span>Visit Store & Save!</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.9rem; color: var(--text-light);">Store pickup total</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">₹${storeTotal}</div>
                        </div>
                        <div style="background: var(--secondary); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold;">
                            Save ₹${total - storeTotal}!
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #E0E0E0;">
                    <button class="btn-secondary" onclick="applyCoupon()" style="width: 100%; padding: 0.75rem;">🎫 Apply Coupon</button>
                </div>
            `;
            html += '</div>';
            summary.innerHTML = html;
        }

        // Registration modal
        function openRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
            currentStep = 1;
            updateStepUI();
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').classList.remove('active');
        }

        function nextStep() {
            if (validateStep(currentStep)) {
                currentStep++;
                updateStepUI();
            }
        }

        function previousStep() {
            currentStep--;
            updateStepUI();
        }

        function updateStepUI() {
            // Update progress
            for (let i = 1; i <= 6; i++) {
                const step = document.getElementById(`progressStep${i}`);
                step.classList.remove('active', 'completed');
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                }
            }

            // Update form steps
            document.querySelectorAll('.form-step').forEach((step, index) => {
                step.classList.toggle('active', index + 1 === currentStep);
            });

            // Update buttons
            document.getElementById('btnPrev').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('btnNext').style.display = currentStep < 6 ? 'block' : 'none';
            document.getElementById('btnSubmit').style.display = currentStep === 6 ? 'block' : 'none';
            
            // Show review summary on step 6
            if (currentStep === 6) {
                const reviewSummary = document.getElementById('reviewSummary');
                reviewSummary.innerHTML = `
                    <div style="display: grid; gap: 0.75rem;">
                        <div><strong>Shop Name:</strong> ${document.getElementById('shopName').value || '-'}</div>
                        <div><strong>Owner:</strong> ${document.getElementById('ownerName').value || '-'}</div>
                        <div><strong>Phone:</strong> ${document.getElementById('phone').value || '-'}</div>
                        <div><strong>Address:</strong> ${document.getElementById('address').value || '-'}</div>
                        <div><strong>Pincode:</strong> ${document.getElementById('pincode').value || '-'}</div>
                        <div><strong>Shop Type:</strong> ${document.getElementById('shopType').value || '-'}</div>
                        <div><strong>Delivery Radius:</strong> ${document.getElementById('deliveryRadius').value} km</div>
                    </div>
                `;
            }
        }

        function validateStep(step) {
            const fields = {
                1: ['shopName', 'ownerName', 'phone'],
                2: ['address', 'pincode'],
                3: ['shopType'],
                4: ['productsServices'],
                5: ['openTime', 'closeTime'],
                6: []
            };

            let isValid = true;
            fields[step].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const group = field.closest('.form-group');
                
                if (!field.value) {
                    group.classList.add('error');
                    isValid = false;
                } else {
                    group.classList.remove('error');
                }
            });

            return isValid;
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude.toFixed(4);
                        const lng = position.coords.longitude.toFixed(4);
                        document.getElementById('locationCoords').textContent = `${lat}, ${lng}`;
                        document.getElementById('locationInfo').classList.add('active');
                        showToast('Location detected successfully!', 'success');
                    },
                    error => {
                        showToast('Unable to get location. Please enter manually.', 'error');
                    }
                );
            } else {
                showToast('Geolocation is not supported by this browser.', 'error');
            }
        }

        function submitRegistration() {
            if (validateStep(6)) {
                closeRegisterModal();
                document.getElementById('successModal').classList.add('active');
                showToast('Shop registered successfully!', 'success');
                
                // Simulate seller login
                currentUser = {
                    type: 'seller',
                    name: document.getElementById('shopName').value
                };
            }
        }

        function closeSuccessModalAndDashboard() {
            closeSuccessModal();
            if (currentUser && currentUser.type === 'seller') {
                showSellerDashboard();
            }
        }

        function showSellerDashboard() {
            showSection('sellerDashboard');
            document.getElementById('sellerDashboard').style.display = 'block';
        }

        function showMyProfile() {
            showSection('buyerProfile');
            document.getElementById('navProfile').style.display = 'block';
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            if (currentUser && currentUser.type === 'seller') {
                showSellerDashboard();
            }
        }

        // Voice search
        function startVoiceSearch(type) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                showToast('Voice search not supported in this browser', 'error');
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = currentLanguage === 'hi' ? 'hi-IN' : 'en-IN';

            const button = event.target;
            button.classList.add('listening');

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                
                if (type === 'location') {
                    document.getElementById('searchLocation').value = transcript;
                } else {
                    document.getElementById('searchProducts').value = transcript;
                    filterProducts();
                }

                showToast(`Recognized: ${transcript}`, 'info');
                button.classList.remove('listening');
            };

            recognition.onerror = () => {
                showToast('Voice recognition error', 'error');
                button.classList.remove('listening');
            };

            recognition.onend = () => {
                button.classList.remove('listening');
            };

            recognition.start();
        }

        // Language toggle
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'hi' : 'en';
            document.getElementById('langToggle').textContent = currentLanguage === 'en' ? 'हिं' : 'EN';
            updateLanguage();
        }

        function updateLanguage() {
            // Update all translatable elements
            Object.keys(translations).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = translations[key][currentLanguage];
                }
            });

            // Re-render dynamic content
            renderSellers();
            renderProducts();
            renderShopTypes();
            addMarkersToMap();
        }

        // Section switching
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Animate impact numbers when impact section is shown
            if (sectionName === 'impact') {
                animateImpactNumbers();
            }
        }

        // Animate impact numbers
        function loadingAnimation() {
            // Simulate loading for demo purposes
            const sections = ['discover', 'products', 'impact'];
            sections.forEach((section, index) => {
                setTimeout(() => {
                    const el = document.getElementById(section);
                    if (el) {
                        el.style.opacity = '0';
                        setTimeout(() => {
                            el.style.transition = 'opacity 0.5s ease';
                            el.style.opacity = '1';
                        }, 50);
                    }
                }, index * 100);
            });
        }

        function animateImpactNumbers() {
            const counters = document.querySelectorAll('.impact-value');
            
            counters.forEach(counter => {
                const target = parseFloat(counter.getAttribute('data-target'));
                const duration = 2000;
                const increment = target / (duration / 16);
                let current = 0;

                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.textContent = Math.ceil(current).toString();
                        requestAnimationFrame(updateCounter);
                    } else {
                        counter.textContent = target.toString();
                    }
                };

                updateCounter();
            });
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div>${message}</div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>